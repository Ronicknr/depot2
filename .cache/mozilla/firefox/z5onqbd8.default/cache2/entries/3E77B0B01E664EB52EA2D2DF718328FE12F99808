<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head>  <title>Перевод Ruby on Rails Tutorial: Изучение Rails на Примерах | Ruby on Rails 3 Tutorial book and screencasts | by Michael Hartl</title>
<meta name="verification" content="a34fd0835be065ac4e649a0e5452b932" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="robots" content="all" />
<meta name="MSSmartTagsPreventParsing" content="true" />
<meta name="description" content="Перевод Ruby on Rails Tutorial: Изучение Rails на Примерах by Michael Hartl" />
<meta name="keywords" content="Изучение Ruby Rails Учебник сайт разработка Rails 3" />
<meta name="author" content="Michael Hartl" />
<meta property="og:title" content="Ruby on Rails Tutorial: Learn Rails by Example"/>
<meta property="og:site_name" content="Ruby on Rails Tutorial"/>
<meta property="og:image" content="http://railstutorial.org/images/layout/logo.png"/>

<meta property="og:url" content="http://railstutorial.org/"/>
<meta property="og:type" content="article" />
<meta property="og:description" content="Ruby on Rails Tutorial: Learn Rails by Example by Michael Hartl teaches web development with Ruby on Rails. Rails Tutorial is fully up-to-date with Rails 3.0." />
<meta name='yandex-verification' content='59b3e8d1c368245d' />
<meta name="verify-reformal" content="4b7dc121caf2baf0963a0473" />
<meta name="google-site-verification" content="JMHh1fZ6uwuY-koyWFZpi3oA5NP3pqs39uaZCZJ3Mr4" />

<link href="/stylesheets/polytexnic.css?1438286578" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/pygments.css?1438286578" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/screen.css?1438286578" media="screen, projection" rel="stylesheet" type="text/css" />
<link href="/stylesheets/custom.css?1438286578" media="screen" rel="stylesheet" type="text/css" />
<script src="/javascripts/jquery-1.6.2.min.js?1438286578" type="text/javascript"></script>
<script src="/javascripts/show_origin.js?1438286578" type="text/javascript"></script>

<!--[if lte IE 7]><link href="/stylesheets/ie.css?1304201481" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lt IE 7]>  <div style='border: 1px solid #F7941D; background: #FEEFDA; text-align: center; clear: both; height: 75px; position: relative;'>    <div style='position: absolute; right: 3px; top: 3px; font-family: courier new; font-weight: bold;'><a href='#' onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-cornerx.jpg' style='border: none;' alt='Close this notice'/></a></div>    <div style='width: 640px; margin: 0 auto; text-align: left; padding: 0; overflow: hidden; color: black;'>      <div style='width: 75px; float: left;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-warning.jpg' alt='Warning!'/></div>      <div style='width: 275px; float: left; font-family: Arial, sans-serif;'>        <div style='font-size: 14px; font-weight: bold; margin-top: 12px;'>Вы используете устаревший браузер</div>        <div style='font-size: 12px; margin-top: 6px; line-height: 12px;'>Для того, чтобы получить от этого сайта максимум того, на что он способен, пожалуйста, обновите свой браузер.</div>      </div>      <div style='width: 75px; float: left;'><a href='http://www.firefox.com' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-firefox.jpg' style='border: none;' alt='Get Firefox 3.5'/></a></div>      <div style='width: 75px; float: left;'><a href='http://www.browserforthebetter.com/download.html' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-ie8.jpg' style='border: none;' alt='Get Internet Explorer 8'/></a></div>      <div style='width: 73px; float: left;'><a href='http://www.apple.com/safari/download/' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-safari.jpg' style='border: none;' alt='Get Safari 4'/></a></div>      <div style='float: left;'><a href='http://www.google.com/chrome' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-chrome.jpg' style='border: none;' alt='Get Google Chrome'/></a></div>    </div>  </div>  <![endif]-->
<link href='http://feeds.feedburner.com/railstutorial' rel='alternate' title='Rails Tutorial News' type='application/rss+xml' />

</head><body class="book"><div id="container"><div class="clearfix" id="header"><div id="title"><div id="logo"><a href="http://ruby.railstutorial.org/"><img alt="Logo" src="/images/layout/logo.png?1438286578" /></a></div><h1 id="name"><a href="http://ruby.railstutorial.org/">Ruby on Rails Tutorial</a></h1><br /><h2 id="authors"><a href="http://ruby.railstutorial.org/#author">by Michael Hartl</a></h2></div></div><div id="menu"><div class="links"><div class="box"><span><a href="http://ruby.railstutorial.org/">Оригинал</a></span><span class="division">|</span><span><a href="/chapters/4_0/beginning">Содержание</a></span><span class="division">|</span><span><a href="/4_0/help">Помощь</a></span></div></div></div><div id="content"><div id="sidebar"><div class="content"><div id="navtool"><table class="layout"><tr><td colspan="2"><a href="#book_menu"><img alt="Sb_button_up" src="/images/buttons/sb_button_up.png?1438286577" /></a></td></tr><tr><td><a href="beginning#top"><img alt="Previous Chapter" src="/images/buttons/sb_button_prev.png?1438286577" /></a></td><td><a href="static-pages#top"><img alt="Next Chapter" src="/images/buttons/sb_button_next.png?1438286577" /></a></td></tr></table><br /><a href="http://ruby.railstutorial.org/#buy"><img alt="Sb_button_buy_screencasts_red" src="/images/buttons/sb_button_buy_screencasts_red.png?1438286577" /></a><div class="section"><div class="switcher custom"><span class="switcher_link title round"><a href="/chapters/4_0/beginning">Rails 4.0</a></span>&nbsp;•&nbsp; <span class="switcher_link "><a href="/chapters/3_2/beginning">Rails 3.2</a></span></div></div><a href="http://orphus.ru" id="orphus" rel="nofollow" target="_blank"><img alt="Система Orphus" border="0" height="31" src="/images/orphus.gif" width="88" /></a></div></div></div><div class="withsidebar" id="main"><div id="book_menu"><a href="#top">пропустить содержание</a></div><div id="book_wrap">
  <div id="book_top">
  </div>
    <div id="book">
      <h1 class="title">Ruby on Rails Tutorial </h1>


<h1 class="subtitle"> Изучение Rails на Примерах</h1>


<h2 class="author">Майкл Хартл</h2>


<h1 class="contents">Содержание</h1>


<div id="table_of_contents"><ol>
<li class="chapter"><a href="preface#top"> Предисловие к русскому изданию</a></li>
<li class="chapter"><a href="beginning#top"><span class="number">Глава 1</span> От нуля к развертыванию</a></li>
<li><ol><li class="section"><a href="beginning#sec-introduction"><span class="number">1.1</span> Введение</a></li>
<li><ol><li class="subsection"><a href="beginning#sec-comments_for_various_readers"><span class="number">1.1.1</span> Комментарии для разных читателей</a></li>
<li class="subsection"><a href="beginning#sec-1_1_2"><span class="number">1.1.2</span> &ldquo;Масштабирование&rdquo; Rails</a></li>
<li class="subsection"><a href="beginning#sec-conventions"><span class="number">1.1.3</span> Соглашения в этой книге</a></li>
</ol></li>
<li class="section"><a href="beginning#sec-up_and_running"><span class="number">1.2</span> За работу</a></li>
<li><ol><li class="subsection"><a href="beginning#sec-development_tools"><span class="number">1.2.1</span> Среда разработки</a></li>
<li><ol><li class="subsubsection"><a href="beginning#sec-1_2_1_1">Интегрированные Среды Разработки</a></li>
<li class="subsubsection"><a href="beginning#sec-1_2_1_2">Текстовые редакторы и инструменты командной строки</a></li>
<li class="subsubsection"><a href="beginning#sec-1_2_1_3">Браузеры</a></li>
<li class="subsubsection"><a href="beginning#sec-1_2_1_4">Примечание об инструментах</a></li>
</ol></li>
<li class="subsection"><a href="beginning#sec-rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails и Git</a></li>
<li><ol><li class="subsubsection"><a href="beginning#sec-rails_installer_windows">Rails Installer (Windows)</a></li>
<li class="subsubsection"><a href="beginning#sec-install_git">Установка Git</a></li>
<li class="subsubsection"><a href="beginning#sec-install_ruby">Установка Ruby</a></li>
<li class="subsubsection"><a href="beginning#sec-install_rubygems">Установка RubyGems</a></li>
<li class="subsubsection"><a href="beginning#sec-install_rails">Установка Rails</a></li>
</ol></li>
<li class="subsection"><a href="beginning#sec-the_first_application"><span class="number">1.2.3</span> Первое приложение</a></li>
<li class="subsection"><a href="beginning#sec-bundler"><span class="number">1.2.4</span> Bundler</a></li>
<li class="subsection"><a href="beginning#sec-rails_server"><span class="number">1.2.5</span> <tt>rails server</tt></a></li>
<li class="subsection"><a href="beginning#sec-mvc"><span class="number">1.2.6</span> Модель-представление-контроллер (MVC)</a></li></ol></li>
<li class="section"><a href="beginning#sec-version_control"><span class="number">1.3</span> Управление версиями с Git</a></li>
<li><ol><li class="subsection"><a href="beginning#sec-git_setup"><span class="number">1.3.1</span> Установка и настройка</a></li>
<li><ol><li class="subsubsection"><a href="beginning#sec-1_3_1_1">Первоначальная настройка системы</a></li>
<li class="subsubsection"><a href="beginning#sec-1_3_1_2">Первоначальная настройка репозитория</a></li></ol></li>
<li class="subsection"><a href="beginning#sec-adding_and_committing"><span class="number">1.3.2</span> Добавление и фиксация</a></li>
<li class="subsection"><a href="beginning#sec-1_3_3"><span class="number">1.3.3</span> Что хорошего Git делает для вас?</a></li>
<li class="subsection"><a href="beginning#sec-github"><span class="number">1.3.4</span> GitHub</a></li>
<li class="subsection"><a href="beginning#sec-git_commands"><span class="number">1.3.5</span> Ветвление, редактирование, фиксация, объединение</a></li>
<li><ol><li class="subsubsection"><a href="beginning#sec-git_branch">Ветвление</a></li>
<li class="subsubsection"><a href="beginning#sec-git_edit">Редактирование</a></li>
<li class="subsubsection"><a href="beginning#sec-git_commit">Фиксация</a></li>
<li class="subsubsection"><a href="beginning#sec-git_merge">Объединение</a></li>
<li class="subsubsection"><a href="beginning#sec-git_push">Отправка</a></li></ol></li></ol></li>
<li class="section"><a href="beginning#sec-deploying"><span class="number">1.4</span> Развертывание</a></li>
<li><ol><li class="subsection"><a href="beginning#sec-heroku_setup"><span class="number">1.4.1</span> Установка Heroku</a></li>
<li class="subsection"><a href="beginning#sec-heroku_step_one"><span class="number">1.4.2</span> Развертывание на Heroku, шаг первый</a></li>
<li class="subsection"><a href="beginning#sec-1_4_3"><span class="number">1.4.3</span> Развертывание на Heroku, шаг второй</a></li>
<li class="subsection"><a href="beginning#sec-heroku_commands"><span class="number">1.4.4</span> Команды Heroku</a></li></ol></li>
<li class="section"><a href="beginning#sec-beginning_conclusion"><span class="number">1.5</span> Заключение</a></li></ol></li>
<li class="chapter"><a href="a-demo-app#top"><span class="number">Глава 2</span> demo app</a></li>
<li><ol><li class="section"><a href="a-demo-app#sec-planning_the_application"><span class="number">2.1</span> Планирование приложения</a></li>
<li><ol><li class="subsection"><a href="a-demo-app#sec-modeling_demo_users"><span class="number">2.1.1</span> Моделирование пользователей</a></li>
<li class="subsection"><a href="a-demo-app#sec-modeling_demo_microposts"><span class="number">2.1.2</span> Моделирование микросообщений</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec-demo_users_resource"><span class="number">2.2</span> Ресурс Users</a></li>
<li><ol><li class="subsection"><a href="a-demo-app#sec-a_user_tour"><span class="number">2.2.1</span> Обзор пользователя</a></li>
<li class="subsection"><a href="a-demo-app#sec-mvc_in_action"><span class="number">2.2.2</span> MVC в действии</a></li>
<li class="subsection"><a href="a-demo-app#sec-weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Недостатки данного ресурса Users</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec-microposts_resource"><span class="number">2.3</span> Ресурс Microposts</a></li>
<li><ol><li class="subsection"><a href="a-demo-app#sec-a_micropost_microtour"><span class="number">2.3.1</span> Микрообзор микросообщений</a></li>
<li class="subsection"><a href="a-demo-app#sec-putting_the_micro_in_microposts"><span class="number">2.3.2</span> Помещение <em>micro</em> в микросообщения</a></li>
<li class="subsection"><a href="a-demo-app#sec-demo_user_has_many_microposts"><span class="number">2.3.3</span> Пользователь <code>has_many</code> микросообщений</a></li>
<li class="subsection"><a href="a-demo-app#sec-inheritance_hierarchies"><span class="number">2.3.4</span> Иерархия наследования</a></li>
<li class="subsection"><a href="a-demo-app#sec-deploying_the_demo_app"><span class="number">2.3.5</span> Развертывание демонстрационного приложения</a></li></ol></li>
<li class="section"><a href="a-demo-app#sec-2_4"><span class="number">2.4</span> Заключение</a></li></ol></li>
<li class="chapter"><a href="static-pages#top"><span class="number">Глава 3</span> В основном статические страницы</a></li>
<li><ol><li class="section"><a href="static-pages#sec-static_pages"><span class="number">3.1</span> Статические страницы</a></li>
<li class="section"><a href="static-pages#sec-first_tests"><span class="number">3.2</span> Наши первые тесты</a></li>
<li><ol><li class="subsection"><a href="static-pages#sec-TDD"><span class="number">3.2.1</span> Разработка через тестирование</a></li>
<li class="subsection"><a href="static-pages#sec-adding_a_page"><span class="number">3.2.2</span> Добавление страницы</a></li>
<li><ol><li class="subsubsection"><a href="static-pages#sec-red" style="color: red;">Красный</a></li>
<li class="subsubsection"><a href="static-pages#sec-green" style="color: green;">Зеленый</a></li>
<li class="subsubsection"><a href="static-pages#sec-refactor">Refactor (реорганизация)</a></li></ol></li></ol></li>
<li class="section"><a href="static-pages#sec-slightly_dynamic_pages"><span class="number">3.3</span> Немного динамические страницы</a></li>
<li><ol><li class="subsection"><a href="static-pages#sec-testing_a_title_change"><span class="number">3.3.1</span> Тестирование изменения заголовка</a></li>
<li class="subsection"><a href="static-pages#sec-passing_title_tests"><span class="number">3.3.2</span> Прохождение тестов заголовка</a></li>
<li class="subsection"><a href="static-pages#sec-embedded_ruby"><span class="number">3.3.3</span> Встроенный Ruby</a></li>
<li class="subsection"><a href="static-pages#sec-layouts"><span class="number">3.3.4</span> Устранение дублирования шаблонами</a></li></ol></li>
<li class="section"><a href="static-pages#sec-static_pages_conclusion"><span class="number">3.4</span> Заключение</a></li>
<li class="section"><a href="static-pages#sec-static_pages_exercises"><span class="number">3.5</span> Упражнения</a></li>
<li class="section"><a href="static-pages#sec-advanced_setup"><span class="number">3.6</span> Продвинутые настройки</a></li>
<li><ol><li class="subsection"><a href="static-pages#sec-eliminating_bundle_exec"><span class="number">3.6.1</span> Избавляемся от <tt>bundle exec</tt></a></li>
<li><ol><li class="subsubsection"><a href="static-pages#sec-rvm_bundler_integration">RVM Bundler интеграция</a></li>
<li class="subsubsection"><a href="static-pages#sec-binstubs">binstubs</a></li></ol></li>
<li class="subsection"><a href="static-pages#sec-guard"><span class="number">3.6.2</span> Автоматизируем тесты с Guard</a></li>
<li class="subsection"><a href="static-pages#sec-spork"><span class="number">3.6.3</span> Ускоряем тесты с помощью Spork</a></li>
<li><ol><li class="subsubsection"><a href="static-pages#sec-spork_and_guard">Guard и Spork</a></li></ol></li>
<li class="subsection"><a href="static-pages#sec-tests_inside_sublime_text"><span class="number">3.6.4</span> Запускаем тесты внутри Sublime Text</a></li></ol></li></ol></li>
<li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Глава 4</span> Rails-приправленный Ruby</a></li>
<li><ol><li class="section"><a href="rails-flavored-ruby#sec-motivation"><span class="number">4.1</span> Причины</a></li>
<li class="section"><a href="rails-flavored-ruby#sec-strings_and_methods"><span class="number">4.2</span> Строки и методы</a></li>
<li><ol><li class="subsection"><a href="rails-flavored-ruby#sec-comments"><span class="number">4.2.1</span> Комментарии</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-strings"><span class="number">4.2.2</span> Строки</a></li>
<li><ol><li class="subsubsection"><a href="rails-flavored-ruby#sec-printing">Вывод на экран</a></li>
<li class="subsubsection"><a href="rails-flavored-ruby#sec-single_quoted_strings">Строки в одинарных кавычках</a></li></ol></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-objects_and_message_passing"><span class="number">4.2.3</span> Объекты и передача сообщений</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-method_definitions"><span class="number">4.2.4</span> Определение методов</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-back_to_the_title_helper"><span class="number">4.2.5</span> Возвращение к <code>title</code> хелперу</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec-other_data_structures"><span class="number">4.3</span> Другие структуры данных</a></li>
<li><ol><li class="subsection"><a href="rails-flavored-ruby#sec-arrays_and_ranges"><span class="number">4.3.1</span> Массивы и диапазоны</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-blocks"><span class="number">4.3.2</span> Блоки</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-hashes_and_symbols"><span class="number">4.3.3</span> Хэши и символы</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-css_revisited"><span class="number">4.3.4</span> Вновь CSS</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec-ruby_classes"><span class="number">4.4</span> Ruby классы</a></li>
<li><ol><li class="subsection"><a href="rails-flavored-ruby#sec-constructors"><span class="number">4.4.1</span> Конструкторы</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-a_class_of_our_own"><span class="number">4.4.2</span> Наследование классов</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-modifying_built_in_classes"><span class="number">4.4.3</span> Изменение встроенных классов</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-a_controller_class"><span class="number">4.4.4</span> Класс контроллер</a></li>
<li class="subsection"><a href="rails-flavored-ruby#sec-a_user_class"><span class="number">4.4.5</span> Класс User</a></li></ol></li>
<li class="section"><a href="rails-flavored-ruby#sec-conclusion"><span class="number">4.5</span> Заключение</a></li>
<li class="section"><a href="rails-flavored-ruby#sec-exercises"><span class="number">4.6</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Глава 5</span> Заполнение шаблона</a></li>
<li><ol><li class="section"><a href="filling-in-the-layout#sec-structure"><span class="number">5.1</span> Добавление некоторых структур</a></li>
<li><ol><li class="subsection"><a href="filling-in-the-layout#sec-adding_to_the_layout"><span class="number">5.1.1</span> Навигация по сайту</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec-custom_css"><span class="number">5.1.2</span> Bootstrap и кастомные CSS</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec-partials"><span class="number">5.1.3</span> Частичные шаблоны (partials)</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec-sass_and_the_asset_pipeline"><span class="number">5.2</span> Sass и файлопровод (asset pipeline)</a></li>
<li><ol><li class="subsection"><a href="filling-in-the-layout#sec-the_asset_pipeline"><span class="number">5.2.1</span> Файлопровод</a></li>
<li><ol><li class="subsubsection"><a href="filling-in-the-layout#sec-5_2_1_1">Директории ассетов</a></li>
<li class="subsubsection"><a href="filling-in-the-layout#sec-5_2_1_2">Файлы-манифесты</a></li>
<li class="subsubsection"><a href="filling-in-the-layout#sec-5_2_1_3">Препроцессоры</a></li>
<li class="subsubsection"><a href="filling-in-the-layout#sec-5_2_1_4">Производительность в продакшен</a></li></ol></li>
<li class="subsection"><a href="filling-in-the-layout#sec-sass"><span class="number">5.2.2</span> Синтаксически обалденные таблицы стилей</a></li>
<li><ol><li class="subsubsection"><a href="filling-in-the-layout#sec-5_2_2_1">Вложение</a></li>
<li class="subsubsection"><a href="filling-in-the-layout#sec-5_2_2_2">Переменные</a></li></ol></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec-layout_links"><span class="number">5.3</span> Ссылки в шаблоне</a></li>
<li><ol><li class="subsection"><a href="filling-in-the-layout#sec-route_tests"><span class="number">5.3.1</span> Тестирование маршрутов</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec-rails_routes"><span class="number">5.3.2</span> Rails маршруты</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec-named_routes"><span class="number">5.3.3</span> Именованные маршруты</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec-pretty_rspec"><span class="number">5.3.4</span> Приятный RSpec</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec-user_signup"><span class="number">5.4</span> Регистрация пользователей: Первый шаг</a></li>
<li><ol><li class="subsection"><a href="filling-in-the-layout#sec-users_controller"><span class="number">5.4.1</span> Контроллер Users</a></li>
<li class="subsection"><a href="filling-in-the-layout#sec-signup_url"><span class="number">5.4.2</span> URL для регистрации</a></li></ol></li>
<li class="section"><a href="filling-in-the-layout#sec-layout_conclusion"><span class="number">5.5</span> Заключение</a></li>
<li class="section"><a href="filling-in-the-layout#sec-layout_exercises"><span class="number">5.6</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="modeling-users#top"><span class="number">Глава 6</span> Моделирование пользователей</a></li>
<li><ol><li class="section"><a href="modeling-users#sec-user_model"><span class="number">6.1</span> Модель User</a></li>
<li><ol><li class="subsection"><a href="modeling-users#sec-database_migrations"><span class="number">6.1.1</span> Миграции базы данных</a></li>
<li class="subsection"><a href="modeling-users#sec-the_model_file"><span class="number">6.1.2</span> Файл модели</a></li>
<li class="subsection"><a href="modeling-users#sec-creating_user_objects"><span class="number">6.1.3</span> Создание объектов user</a></li>
<li class="subsection"><a href="modeling-users#sec-finding_user_objects"><span class="number">6.1.4</span> Поиск объектов user</a></li>
<li class="subsection"><a href="modeling-users#sec-updating_user_objects"><span class="number">6.1.5</span> Обновление объектов user</a></li></ol></li>
<li class="section"><a href="modeling-users#sec-user_validations"><span class="number">6.2</span> Валидации User</a></li>
<li><ol><li class="subsection"><a href="modeling-users#sec-initial_user_tests"><span class="number">6.2.1</span> Начальные тесты для пользователей</a></li>
<li class="subsection"><a href="modeling-users#sec-presence_validation"><span class="number">6.2.2</span> Валидация наличия</a></li>
<li class="subsection"><a href="modeling-users#sec-length_validation"><span class="number">6.2.3</span> Валидация длины</a></li>
<li class="subsection"><a href="modeling-users#sec-format_validation"><span class="number">6.2.4</span> Валидация формата</a></li>
<li class="subsection"><a href="modeling-users#sec-uniqueness_validation"><span class="number">6.2.5</span> Валидация уникальности</a></li>
<li><ol><li class="subsubsection"><a href="modeling-users#sec-the_caveat">Предостережение уникальности</a></li></ol></li></ol></li>
<li class="section"><a href="modeling-users#sec-adding_a_secure_password"><span class="number">6.3</span> Добавление безопасного пароля</a></li>
<li><ol><li class="subsection"><a href="modeling-users#sec-an_encrypted_password"><span class="number">6.3.1</span> Зашифрованный пароль</a></li>
<li class="subsection"><a href="modeling-users#sec-password_and_confirmation"><span class="number">6.3.2</span> Пароль и подтверждение</a></li>
<li class="subsection"><a href="modeling-users#sec-user_authentication"><span class="number">6.3.3</span> Аутентификация пользователя</a></li>
<li class="subsection"><a href="modeling-users#sec-has_secure_password"><span class="number">6.3.4</span> У пользователя есть безопасный пароль</a></li>
<li class="subsection"><a href="modeling-users#sec-creating_a_user"><span class="number">6.3.5</span> Создание пользователя</a></li></ol></li>
<li class="section"><a href="modeling-users#sec-6_4"><span class="number">6.4</span> Заключение</a></li>
<li class="section"><a href="modeling-users#sec-6_5"><span class="number">6.5</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="sign-up#top"><span class="number">Chapter 7</span> Регистрация</a></li>
<li><ol><li class="section"><a href="sign-up#sec-showing_users"><span class="number">7.1</span> Демонстрация пользователей</a></li>
<li><ol><li class="subsection"><a href="sign-up#sec-rails_environments"><span class="number">7.1.1</span> Отладка и окружения Rails</a></li>
<li class="subsection"><a href="sign-up#sec-a_users_resource"><span class="number">7.1.2</span> A Ресурс Users</a></li>
<li class="subsection"><a href="sign-up#sec-tests_with_factories"><span class="number">7.1.3</span> Тестирование страницы показывающей пользователя (с фабриками)</a></li>
<li class="subsection"><a href="sign-up#sec-a_gravatar_image"><span class="number">7.1.4</span> Изображение Gravatar и боковая панель</a></li></ol></li>
<li class="section"><a href="sign-up#sec-signup_form"><span class="number">7.2</span> Форма регистрации</a></li>
<li><ol><li class="subsection"><a href="sign-up#sec-tests_for_user_signup"><span class="number">7.2.1</span> Тесты для регистрации пользователя</a></li>
<li class="subsection"><a href="sign-up#sec-using_form_for"><span class="number">7.2.2</span> Применение <tt>form_for</tt></a></li>
<li class="subsection"><a href="sign-up#sec-the_form_html"><span class="number">7.2.3</span> HTML формы</a></li></ol></li>
<li class="section"><a href="sign-up#sec-signup_failure"><span class="number">7.3</span> Провальная регистрация</a></li>
<li><ol><li class="subsection"><a href="sign-up#sec-a_working_form"><span class="number">7.3.1</span> Рабочая форма</a></li>
<li class="subsection"><a href="sign-up#sec-strong_parameters"><span class="number">7.3.2</span> Строгие параметры</a></li>
<li class="subsection"><a href="sign-up#sec-signup_error_messages"><span class="number">7.3.3</span> Сообщения об ошибках при регистрации</a></li></ol></li>
<li class="section"><a href="sign-up#sec-signup_success"><span class="number">7.4</span> Успешная регистрация</a></li>
<li><ol><li class="subsection"><a href="sign-up#sec-the_finished_signup_form"><span class="number">7.4.1</span> Завершенная форма регистрации</a></li>
<li class="subsection"><a href="sign-up#sec-the_flash"><span class="number">7.4.2</span> Флэш</a></li>
<li class="subsection"><a href="sign-up#sec-the_first_signup"><span class="number">7.4.3</span> Первая регистрация</a></li>
<li class="subsection"><a href="sign-up#sec-deploying_to_production_with_ssl"><span class="number">7.4.4</span> Развертывание приложения на сервере с SSL</a></li></ol></li>
<li class="section"><a href="sign-up#sec-7_5"><span class="number">7.5</span> Заключение</a></li>
<li class="section"><a href="sign-up#sec-signup_exercises"><span class="number">7.6</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Глава 8</span> Войти, выйти</a></li>
<li><ol><li class="section"><a href="sign-in-sign-out#sec-signin_failure"><span class="number">8.1</span> Сессии и провальный вход</a></li>
<li><ol><li class="subsection"><a href="sign-in-sign-out#sec-sessions_controller"><span class="number">8.1.1</span> Sessions контроллер</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-signin_tests"><span class="number">8.1.2</span> Тестирование входа</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-signin_form"><span class="number">8.1.3</span> Форма для входа</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-reviewing_form_submission"><span class="number">8.1.4</span> Обзор отправки формы</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-rendering_with_a_flash_message"><span class="number">8.1.5</span> Рендеринг
с флэш сообщением</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec-signin_success"><span class="number">8.2</span> Успешный вход</a></li>
<li><ol><li class="subsection"><a href="sign-in-sign-out#sec-remember_me"><span class="number">8.2.1</span> Запомнить меня</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-a_working_sign_in_method"><span class="number">8.2.2</span> Рабочий метод <tt>sign_in</tt></a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-current_user"><span class="number">8.2.3</span> Текущий пользователь</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-changing_the_layout_links"><span class="number">8.2.4</span> Изменение ссылок шаблона</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-signin_upon_signup"><span class="number">8.2.5</span> Вход после регистрации</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-signing_out"><span class="number">8.2.6</span> Выход</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec-cucumber"><span class="number">8.3</span> Введение в Cucumber (опционально)</a></li>
<li><ol><li class="subsection"><a href="sign-in-sign-out#sec-installation_and_setup"><span class="number">8.3.1</span> Установка и настройка</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-features_and_steps"><span class="number">8.3.2</span> Фичи и шаги</a></li>
<li class="subsection"><a href="sign-in-sign-out#sec-rspec_custom_matchers"><span class="number">8.3.3</span> Контрапункт: кастомные проверки RSpec</a></li></ol></li>
<li class="section"><a href="sign-in-sign-out#sec-8_4"><span class="number">8.4</span> Заключение</a></li>
<li class="section"><a href="sign-in-sign-out#sec-sign_in_out_exercises"><span class="number">8.5</span> Упражнения</a></li></ol></li>

<li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Глава 9</span> Обновление, демонстрация и удаление пользователей</a></li>
<li><ol><li class="section"><a href="updating-showing-and-deleting-users#sec-updating_users"><span class="number">9.1</span> Обновление пользователей</a></li>
<li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-edit_form"><span class="number">9.1.1</span> Форма для редактирования</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-unsuccessful_edits"><span class="number">9.1.2</span> Провальное редактирование</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-successful_edits"><span class="number">9.1.3</span> Успешное редактирование</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec-authorization"><span class="number">9.2</span> Авторизация</a></li>
<li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-requiring_signed_in_users"><span class="number">9.2.1</span> Требование входа пользователей</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-requiring_the_right_user"><span class="number">9.2.2</span> Требование правильного пользователя</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-friendly_forwarding"><span class="number">9.2.3</span> Дружелюбная переадресация</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec-showing_all_users"><span class="number">9.3</span> Отображение всех пользователей</a></li>
<li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-user_index"><span class="number">9.3.1</span> Список пользователей</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-sample_users"><span class="number">9.3.2</span> Образцы пользователей</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-pagination"><span class="number">9.3.3</span> Пагинация</a></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-partial_refactoring"><span class="number">9.3.4</span> Частичный рефакторинг</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec-destroying_users"><span class="number">9.4</span> Уничтожение пользователей</a></li>
<li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-administrative_users"><span class="number">9.4.1</span> Административные пользователи</a></li>
<li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec-revisiting_strong_parameters">Возвращение к строгим параметрам</a></li></ol></li>
<li class="subsection"><a href="updating-showing-and-deleting-users#sec-the_destroy_action"><span class="number">9.4.2</span> <tt>Destroy</tt> действие</a></li></ol></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec-updating_and_deleting_users_conclusion"><span class="number">9.5</span> Заключение</a></li>
<li class="section"><a href="updating-showing-and-deleting-users#sec-updating_deleting_exercises"><span class="number">9.6</span> Упражнения</a></li></ol></li>

<li class="chapter"><a href="user-microposts#top"><span class="number">Глава 10</span> Микросообщения пользователей</a></li>
<li><ol><li class="section"><a href="user-microposts#sec-a_micropost_model"><span class="number">10.1</span> Модель Micropost</a></li>
<li><ol><li class="subsection"><a href="user-microposts#sec-the_basic_model"><span class="number">10.1.1</span> Базовая модель</a></li>
<li class="subsection"><a href="user-microposts#sec-first_micropost_validation"><span class="number">10.1.2</span> Первая валидация</a></li>
<li class="subsection"><a href="user-microposts#sec-user_micropost_associations"><span class="number">10.1.3</span> Ассоциации Пользователь/Микросообщения</a></li>
<li class="subsection"><a href="user-microposts#sec-ordering_and_dependency"><span class="number">10.1.4</span> Улучшение микросообщений</a></li>
<li><ol><li class="subsubsection"><a href="user-microposts#sec-default_scope">Дефолтное пространство (scope)</a></li>
<li class="subsubsection"><a href="user-microposts#sec-dependent_destroy">Dependent: destroy</a></li></ol></li>
<li class="subsection"><a href="user-microposts#sec-micropost_validations"><span class="number">10.1.5</span> Валидации контента</a></li></ol></li>
<li class="section"><a href="user-microposts#sec-showing_microposts"><span class="number">10.2</span> Просмотр микросообщений</a></li>
<li><ol><li class="subsection"><a href="user-microposts#sec-augmenting_the_user_show_page"><span class="number">10.2.1</span> Дополнение страницы показывающей пользователя</a></li>
<li class="subsection"><a href="user-microposts#sec-sample_microposts"><span class="number">10.2.2</span> Образцы микросообщений</a></li></ol></li>
<li class="section"><a href="user-microposts#sec-manipulating_microposts"><span class="number">10.3</span> Манипулирование микросообщениями</a></li>
<li><ol><li class="subsection"><a href="user-microposts#sec-access_control"><span class="number">10.3.1</span> Контроль доступа</a></li>
<li class="subsection"><a href="user-microposts#sec-creating_microposts"><span class="number">10.3.2</span> Создание микросообщений</a></li>
<li class="subsection"><a href="user-microposts#sec-a_proto_feed"><span class="number">10.3.3</span> Предварительная реализация потока сообщений</a></li>
<li class="subsection"><a href="user-microposts#sec-destroying_microposts"><span class="number">10.3.4</span> Уничтожение микросообщений</a></li></ol></li>
<li class="section"><a href="user-microposts#sec-10_4"><span class="number">10.4</span> Заключение</a></li>
<li class="section"><a href="user-microposts#sec-micropost_exercises"><span class="number">10.5</span> Упражнения</a></li></ol></li>
<li class="chapter"><a href="following-users#top"><span class="number">Глава 11</span> Слежение за сообщениями пользователей</a></li>
<li><ol><li class="section"><a href="following-users#sec-the_relationship_model"><span class="number">11.1</span> Модель Relationship</a></li>
<li><ol><li class="subsection"><a href="following-users#sec-a_problem_with_the_data_model"><span class="number">11.1.1</span> Проблема с моделью данных (и ее решение)</a></li>
<li class="subsection"><a href="following-users#sec-relationship_user_associations"><span class="number">11.1.2</span> Ассоциации пользователь/взаимоотношение</a></li>
<li class="subsection"><a href="following-users#sec-relationship_validations"><span class="number">11.1.3</span> Валидации</a></li>
<li class="subsection"><a href="following-users#sec-following"><span class="number">11.1.4</span> Читаемые пользователи</a></li>
<li class="subsection"><a href="following-users#sec-followers"><span class="number">11.1.5</span> Читатели пользователя</a></li></ol></li>
<li class="section"><a href="following-users#sec-a_web_interface_for_following_and_followers"><span class="number">11.2</span> Веб-интерфейс для читаемых пользователей</a></li>
<li><ol><li class="subsection"><a href="following-users#sec-sample_following_data"><span class="number">11.2.1</span> Образцы данных</a></li>
<li class="subsection"><a href="following-users#sec-stats_and_a_follow_form"><span class="number">11.2.2</span> Статистика и форма для слежения за сообщениями пользователя</a></li>
<li class="subsection"><a href="following-users#sec-following_and_followers_pages"><span class="number">11.2.3</span> Страницы с читаемыми и читателями</a></li>
<li class="subsection"><a href="following-users#sec-a_working_follow_button_the_standard_way"><span class="number">11.2.4</span> Стандартный способ реализации кнопки "читать" (follow)</a></li>
<li class="subsection"><a href="following-users#sec-a_working_follow_button_with_ajax"><span class="number">11.2.5</span> Реализация кнопки "читать" (follow) с Ajax</a></li></ol></li>
<li class="section"><a href="following-users#sec-the_status_feed"><span class="number">11.3</span> Поток сообщений</a></li>
<li><ol><li class="subsection"><a href="following-users#sec-motivation_and_strategy"><span class="number">11.3.1</span> Мотивация и стратегия</a></li>
<li class="subsection"><a href="following-users#sec-a_first_feed_implementation"><span class="number">11.3.2</span> Первая реализация потока сообщений</a></li>
<li class="subsection"><a href="following-users#sec-scopes_subselects_and_a_lambda"><span class="number">11.3.3</span> Подзапросы</a></li>
<li class="subsection"><a href="following-users#sec-the_new_status_feed"><span class="number">11.3.4</span> Новый поток сообщений</a></li></ol></li>
<li class="section"><a href="following-users#sec-following_conclusion"><span class="number">11.4</span> Заключение</a></li>
<li><ol><li class="subsection"><a href="following-users#sec-extensions_to_the_sample_application"><span class="number">11.4.1</span> Расширения к примеру приложения</a></li>
<li><ol><li class="subsubsection"><a href="following-users#sec-replies">Реплики</a></li>
<li class="subsubsection"><a href="following-users#sec-messaging">Обмен сообщениями</a></li>
<li class="subsubsection"><a href="following-users#sec-follower_notifications">Уведомления о новых читателях</a></li>
<li class="subsubsection"><a href="following-users#sec-password_reminders">Напоминание пароля</a></li>
<li class="subsubsection"><a href="following-users#sec-signup_confirmation">Подтверждение регистрации</a></li>
<li class="subsubsection"><a href="following-users#sec-rss_feed">RSS канал</a></li>
<li class="subsubsection"><a href="following-users#sec-rest_api">REST API</a></li>
<li class="subsubsection"><a href="following-users#sec-search">Поиск</a></li></ol></li>
<li class="subsection"><a href="following-users#sec-guide_to_further_resources"><span class="number">11.4.2</span> Руководство по дальнейшим ресурсам</a></li></ol></li>
<li class="section"><a href="following-users#sec-following_exercises"><span class="number">11.5</span> Упражнения</a></li></ol></li></ol></div>

      <div id="main_content"></div>


<p> <span class="preamble">
 <span id="foreword">
<strong> Предисловие</strong> <br />
 </span>
 </span></p>

<p>Моя компания (CD Baby) была одной из первых громко перешедших на Ruby on Rails, а затем еще громче вернувшейся обратно на PHP (Google расскажет вам об этой драме). Эту книгу, написанную Майклом Хартлом так высоко рекомендовали, что я должен был попробовать её, и <em>Ruby on Rails Tutorial</em> это всё, что я использовал, чтобы вернуться к Rails.</p>

<p>Хотя я уже прошел через много книг по Rails, это одна из немногих, что, наконец, зацепила меня. Было много написано книг типа &laquo;Путь Rails&raquo; — после которых я чувствовал себя неестественно, но после этой книги я наконец почувствовал себя естественно. Это также единственная книга по Rails, которая соблюдает методику &laquo;разработка через тестирование&raquo; на всем своем протяжении, этот подход строго рекомендуется специалистами, но он никогда не был так чётко продемонстрирован ранее. Наконец, Git, GitHub и Heroku присутствуют в демо-примерах, автор действительно дает вам почувствовать, что он хотел сделать реальный проект. Учебный код примеров не изолирован.</p>

<p>Линейное повествование — отличный формат. Лично я прошел Rails Tutorial в течении трёх долгих дней, делая все примеры и задачи в конце каждой главы. Делайте всё от начала до конца, не прыгая, и вы получите максимальную пользу.</p>

<p>Наслаждайтесь!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Основатель </em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br /></p>

<p> <span class="preamble">
<strong> Благодарности</strong> <br />
 </span></p>

<p><em>Ruby On Rails Учебник</em> во многом обязан моей предыдущей книге по Rails, <em>RailsSpace</em> и, следовательно, моему соавтору <a  href="http://aure.com/">Aurelius Prochazka</a>. Я хотел бы поблагодарить Aure как за работу, которую он проделал над прошлой книгой, так и за поддержку этой. Я также хотел бы поблагодарить Debra Williams Cauley, редактора обеих книг <em>RailsSpace</em> и <em>Rails Tutorial</em>; до тех пор, пока она не прекратит брать меня на бейсбол, я буду продолжать писать книги для нее.</p>

<p>Я хотел бы поблагодарить огромное количество Рубистов учивших и вдохновлявших меня на протяжении многих лет: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Pratik Naik, Sarah Mei, Sarah Allen, Wolfram Arnold, Alex Chaffee, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, хороших людей из Pivotal Labs, команду Heroku, thoughtbot ребят, и команду GitHub. Наконец, многих, многих читателей - слишком много чтобы перечислять их здесь - внёсших большое количество предложений по улучшению и сообщивших об ошибках во время написания этой книги, и я с благодарностью признаю их помощь в написании ее настолько хорошей, насколько это было возможно. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> Об авторе</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Майкл Хартл</a> &#8211; автор <a href="http://ruby.railstutorial.org/"><em>Ruby on Rails Tutorial</em></a>, лидирующего введения в веб разработку на <a href="http://rubyonrails.org/">Ruby on Rails</a>. Его предыдущий опыт включает в себя написание и разработку <em>RailsSpace</em> - чрезвычайно устаревшего учебника по Rails и разработку Insoshi - некогда популярной, а ныне устаревшей платформы для социальных сетей написанной на Ruby on Rails. В 2011, Майкл получил <a href="http://rubyheroes.com/heroes">Ruby Hero Award</a> за его вклад в Ruby сообщество. Он закончил <a href="http://college.harvard.edu/">Harvard College</a>, имеет <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">степень Кандидата Физических Наук</a> присвоенную в <a href="http://www.caltech.edu/">Caltech</a> и является выпускником предпринимательских курсов <a href="http://ycombinator.com/">Y&nbsp;Combinator</a>. <br /></p>

<p> <span id="license" class="preamble">
<strong> Копирайт и лицензия</strong> <br />
 </span></p>

<p><em>Ruby on Rails Tutorial: Learn Web Development with Rails</em>. Copyright &copy; 2012 by Michael Hartl. Весь исходный код в <em>Ruby on Rails Tutorial</em> доступен под <a href="http://opensource.org/licenses/MIT">MIT License</a> и <a href="http://people.freebsd.org/~phk/">Beerware License</a>.</p>

<div class="code"><div class="highlight">

<pre>Лицензия MIT

Copyright (c) 2013 Michael Hartl

Данная лицензия разрешает лицам, получившим копию данного программного
обеспечения и сопутствующей документации (в дальнейшем именуемыми
«Программное Обеспечение»), безвозмездно использовать Программное
Обеспечение без ограничений, включая неограниченное право на использование,
копирование, изменение, добавление, публикацию, распространение,
сублицензирование и/или продажу копий Программного Обеспечения, также
как и лицам, которым предоставляется данное Программное Обеспечение,
при соблюдении следующих условий:

Указанное выше уведомление об авторском праве и данные условия должны быть
включены во все копии или значимые части данного Программного Обеспечения.

ДАННОЕ ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ «КАК ЕСТЬ», БЕЗ КАКИХ-ЛИБО
ГАРАНТИЙ, ЯВНО ВЫРАЖЕННЫХ ИЛИ ПОДРАЗУМЕВАЕМЫХ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ
ГАРАНТИЯМИ ТОВАРНОЙ ПРИГОДНОСТИ, СООТВЕТСТВИЯ ПО ЕГО КОНКРЕТНОМУ НАЗНАЧЕНИЮ И
ОТСУТСТВИЯ НАРУШЕНИЙ ПРАВ. НИ В КАКОМ СЛУЧАЕ АВТОРЫ ИЛИ ПРАВООБЛАДАТЕЛИ НЕ
НЕСУТ ОТВЕТСТВЕННОСТИ ПО ИСКАМ О ВОЗМЕЩЕНИИ УЩЕРБА, УБЫТКОВ ИЛИ ДРУГИХ
ТРЕБОВАНИЙ ПО ДЕЙСТВУЮЩИМ КОНТРАКТАМ, ДЕЛИКТАМ ИЛИ ИНОМУ, ВОЗНИКШИМ ИЗ,
ИМЕЮЩИМ ПРИЧИНОЙ ИЛИ СВЯЗАННЫМ С ПРОГРАММНЫМ ОБЕСПЕЧЕНИЕМ ИЛИ ИСПОЛЬЗОВАНИЕМ
ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ ИЛИ ИНЫМИ ДЕЙСТВИЯМИ С ПРОГРАММНЫМ ОБЕСПЕЧЕНИЕМ.
</pre></div>
</div>


<div class="code"><div class="highlight"><pre>/*
 * ----------------------------------------------------------------------------
 * &quot;ПИВНАЯ ЛИЦЕНЗИЯ&quot; (Ревизия 42):
 * Весь код написан Майклом Хартлом. До тех пор пока вы осознаете это,
 * вы можете делать с ним все что захотите. Если мы когда нибудь
 * встретимся, и если это того стоило, вы можете купить мне
 * пиво в ответ.
 * ----------------------------------------------------------------------------
 */
</pre></div>
</div>

      <div id="top"></div>


<h1 class="chapter"><a id="sec-2" href="a-demo-app#top" class="heading"><span class="number">Глава 2</span> demo app</a></h1>


<p>В этой главе мы разработаем простое демонстрационное приложение, чтобы показать мощь Rails. Цель -  получить общее представление о программировании на Ruby on Rails (и веб-разработке в целом), быстро сгенерировав приложение, используя <em>scaffold generators</em>. Как обсуждалось в <a class="ref" href="beginning#sidebar-scaffolding">Блоке&nbsp;1.2</a>, остальная часть книги будет применять противоположный подход, постепенно разрабатывая приложение с объяснением всех новых понятий по мере их появления, но для быстрого обзора (и некоторого быстрорастворимого удовлетворения) нет ничего лучше чем scaffolding. Конечное  демонстрационное приложение позволит нам взаимодействовать с ним через свои URL, дав нам понимание структуры Rails приложений, включая первый пример <em>REST архитектуры</em> предпочитаемой Rails.</p>

<p>Как и предстоящий пример приложения, демонстрационное приложение будет состоять из <em>пользователей</em> и связанных с ними <em>микросообщений</em> (образуя минималистичное приложение в стиле Twitter). Функциональность будет совершенно слаборазвита и многие из шагов будут походить на волшебство, но не переживайте: полный пример приложения разработает подобное же приложение с нуля, начиная с <a class="ref" href="static-pages#top">Главы&nbsp;3</a>, и я дам многочисленные ссылки на более поздний материал. Тем временем, имейте терпение и немного веры - все таки основная цель данного учебника - удержать вас  <em>вне</em> этого поверхностного, управляемого scaffold подхода, для достижения более глубокого понимания Rails.</p>

<div class="label" id="sec-planning_the_application"></div>


<h2><a id="sec-2_1" href="a-demo-app#sec-planning_the_application" class="heading"><span class="number">2.1</span> Планирование приложения</a></h2>


<p>В этом Разделе мы обрисуем в общих чертах наши планы относительно демонстрационного приложения. Как и в <a class="ref" href="beginning#sec-the_first_application">Разделе&nbsp;1.2.3</a>, мы начнем с создания скелета приложения, используя команду <code>rails</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new demo_app
<span class="gp">$</span> <span class="nb">cd </span>demo_app
</pre></div>
</div>


<p>Затем, мы используем текстовый редактор, чтобы обновить <code>Gemfile</code> необходимый Bundler, содержанием из <a class="ref" href="a-demo-app#code-demo_gemfile_sqlite_version_redux">Листинга&nbsp;2.1</a>.</p>

<div class="label" id="code-demo_gemfile_sqlite_version_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.1.</span> <span class="description"><code>Gemfile</code> для демонстрационного приложения.</span></div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
<span class="n">ruby</span> <span class="s1">&#39;2.0.0&#39;</span>
<span class="c1">#ruby-gemset=railstutorial_rails_4_0</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.8&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.4&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;turbolinks&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.1&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;jbuilder&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:doc</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sdoc&#39;</span><span class="p">,</span> <span class="s1">&#39;0.3.20&#39;</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.15.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rails_12factor&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Отмечу, что <a class="ref" href="a-demo-app#code-demo_gemfile_sqlite_version_redux">Листинг&nbsp;2.1</a> аналогичен <a class="ref" href="beginning#code-gemfile_pg_gem">Листингу&nbsp;1.9</a></p>

<p>Как и в <a class="ref" href="beginning#sec-heroku_setup">Разделе&nbsp;1.4.1</a>, мы установим локальные гемы и предотвратим установку production гемов с помощью опции <tt class="verb">--without production</tt>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install --without production
<span class="gp">$</span> bundle update
<span class="gp">$</span> bundle install
</pre></div>
</div>

<p>(Напомним что если Bundler выдает ошибку связанную с <tt>readline</tt>, стОит попробовать добавить <code>gem &rsquo;rb-readline&rsquo;</code> в ваш <code>Gemfile</code>.)</p>

<p>Наконец, мы поместим наш код в систему контроля версий. Вспомним что <code>rails</code> команда генерирует дефолтный <code>.gitignore</code> файл, но, в зависимости от вашей системы, вы можете найти расширенный файл из <a class="ref" href="beginning#code-gitignore">Листинга&nbsp;1.7</a> гораздо более удобным. Затем инициализируем Git репозиторий и делаем первый коммит:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<div class="label" id="fig-create_demo_repo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_demo_repo_4_0.png" alt="create_demo_repo_4_0" /></span></div><div class="caption"><span class="header">Рисунок 2.1: </span><span class="description">Создание репозитория demo app на GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_demo_repo_4_0-full.png">(полный размер)</a></span></div></div>


<p>Можно также дополнительно создать новый репозиторий (<a class="ref" href="a-demo-app#fig-create_demo_repo">Рис.&nbsp;2.1</a>) и отправить его на GitHub:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin https://github.com/&lt;username&gt;/demo_app.git
<span class="gp">$</span> git push -u origin master
</pre></div>
</div>

<p>(Как и в случае с первым приложением, позаботьтесь о том чтобы <em>не</em> инициализировать  репозиторий GitHub с файлом <code>README</code>.)</p>

<p>Теперь мы готовы начать делать само приложение. Типичный первый шаг, при разработке приложений это создание <em>модели данных</em>, которая является изображением структур, необходимых нашему приложению. В нашем случае demo app будет упрощенным микроблогом: только пользователи и короткие (микро) сообщения. Таким образом, мы начнем с модели для <em>пользователей</em> приложения (<a class="ref" href="a-demo-app#sec-modeling_demo_users">Раздел&nbsp;2.1.1</a>), затем мы добавим модель для <em>микросообщений</em> (<a class="ref" href="a-demo-app#sec-modeling_demo_microposts">Раздел&nbsp;2.1.2</a>).</p>

<div class="label" id="sec-modeling_demo_users"></div>


<h3><a id="sec-2_1_1" href="a-demo-app#sec-modeling_demo_users" class="heading"><span class="number">2.1.1</span> Моделирование пользователей</a></h3>


<p>Вариантов для модели данных пользователя так же много, как много различных форм регистрации в сети; мы пойдем отчетливо минималистичным путем. У пользователей нашего demo app будет уникальный <code>целочисленный</code> идентификатор называемый <code>id</code>, публично видимое <code>имя </code> (тип - <code>string (строка)</code>), и <code>email</code> адрес  (также <code>string</code>) совпадающий с именем пользователя. Итоговая модель данных для пользователей представлена на <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a>.</p>

<div class="label" id="fig-demo_user_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_model.png" alt="demo_user_model" /></span></div><div class="caption"><span class="header">Рис. 2.2: </span><span class="description">Модель данных для пользователей.</span></div></div>


<p>Как мы увидим в <a class="ref" href="modeling-users#sec-database_migrations">Разделе&nbsp;6.1.1</a>, табличка <code>users</code> в <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a> соответствует <em>таблице</em> в базе данных и <code>id</code>, <code>name</code>, и <code>email</code> атрибуты это <em>столбцы</em> этой таблицы.</p>

<div class="label" id="sec-modeling_demo_microposts"></div>


<h3><a id="sec-2_1_2" href="a-demo-app#sec-modeling_demo_microposts" class="heading"><span class="number">2.1.2</span> Моделирование микросообщений</a></h3>


<p>Ядро модели данных микросообщений даже проще чем для пользователей: микросообщение имеет только <code>id</code> и поле <code>content</code> для текста микросообщения (тип- <code>string</code>).<sup class="footnote" id="fnref-2_1"><a href="#fn-2_1">1</a></sup> Есть дополнительная сложность: мы хотим <em>связать</em> каждое микросообщение с определенным пользователем; мы выполним это, записывая <code>user_id</code> владельца сообщения. Результаты показаны на <a class="ref" href="a-demo-app#fig-demo_micropost_model">Рис.&nbsp;2.3</a>.</p>

<div class="label" id="fig-demo_micropost_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_model.png" alt="demo_micropost_model" /></span></div><div class="caption"><span class="header">Рис. 2.3: </span><span class="description">Модель данных для микросообщений.</span></div></div>


<p>Мы увидим в <a class="ref" href="a-demo-app#sec-demo_user_has_many_microposts">Разделе&nbsp;2.3.3</a> (и более полно в <a class="ref" href="user-microposts#top">Главе&nbsp;10</a>) как этот <code>user_id</code> атрибут позволит нам кратко реализовать идею, что у пользователя потенциально есть много связанных с ним микросообщений.</p>

<div class="label" id="sec-demo_users_resource"></div>


<h2><a id="sec-2_2" href="a-demo-app#sec-demo_users_resource" class="heading"><span class="number">2.2</span> Ресурс Users</a></h2>


<p>В этом разделе мы реализуем модель данных пользователей из <a class="ref" href="a-demo-app#sec-modeling_demo_users">Раздела&nbsp;2.1.1</a>, наряду с веб-интерфейсом к этой модели. Эта комбинация образует <em>ресурс Users</em>, который позволит нам думать о пользователях как об объектах, которые могут быть созданы, считаны, обновлены, и удалены через сеть с использованием <a   href="http://ru.wikipedia.org/wiki/HTTP-протокол">HTTP протокола</a>. Как обещалось во введении, наш ресурс Users будет создаваться программой scaffold generator, которая стандартно поставляется с каждым проектом Rails. Я настоятельно прошу вас не всматриваться в генерируемый код; на этом этапе он лишь запутает вас.</p>

<p>Rails scaffolding запускается передачей <code>scaffold</code> команды скрипту <code>rails generate</code>. Аргумент команды <code>scaffold</code> это имя ресурса в единственном числе (в данном случае, <code>User</code>), вместе с дополнительными параметрами для атрибутов модели данных:<sup class="footnote" id="fnref-2_2"><a href="#fn-2_2">2</a></sup></p>

<div class="code"><div class="highlight"><pre>$ rails generate scaffold User name:string email:string
      invoke  active_record
      create    db/migrate/20130305221714_create_users.rb
      create    app/models/user.rb
      invoke    test_unit
      create      test/models/user_test.rb
      create      test/fixtures/users.yml
      invoke  resource_route
       route    resources :users
      invoke  jbuilder_scaffold_controller
      create    app/controllers/users_controller.rb
      invoke    erb
      create      app/views/users
      create      app/views/users/index.html.erb
      create      app/views/users/edit.html.erb
      create      app/views/users/show.html.erb
      create      app/views/users/new.html.erb
      create      app/views/users/_form.html.erb
      invoke    test_unit
      create      test/controllers/users_controller_test.rb
      invoke    helper
      create      app/helpers/users_helper.rb
      invoke      test_unit
      create        test/helpers/users_helper_test.rb
      invoke    jbuilder
       exist      app/views/users
      create      app/views/users/index.json.jbuilder
      create      app/views/users/show.json.jbuilder
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/users.js.coffee
      invoke    scss
      create      app/assets/stylesheets/users.css.scss
      invoke  scss
      create    app/assets/stylesheets/scaffolds.css.scss
</pre></div>
</div>


<p>Добавив <code>name:string</code> и <code>email:string</code>, мы добились того, что модель User приобрела форму соответствующую <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a>. (Отметьте, что нет надобности включать параметр для <code>id</code>; он создается Rails автоматически для использования в качестве <em>primary key</em> в базе данных.)</p>

<p>Чтобы продолжить с демонстрационным приложением, мы сначала должны <em>migrate (мигрировать, переместить)</em> базу данных, используя <em>Rake</em> (<a class="ref" href="a-demo-app#sidebar-rake">Блок&nbsp;2.1</a>):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake db:migrate
<span class="go">==  CreateUsers: migrating ====================================================</span>
<span class="go">-- create_table(:users)</span>
<span class="go">   -&gt; 0.0017s</span>
<span class="go">==  CreateUsers: migrated (0.0018s) ===========================================</span>
</pre></div>
</div>




<p>Это просто обновляет базу данных с нашей новой моделью данных <code>users</code>. (Мы узнаем больше о миграциях баз данных в <a class="ref" href="modeling-users#sec-database_migrations">Разделе&nbsp;6.1.1</a>.) Отметьте, что для того, чтобы обеспечить использование версии Rake, соответствующей нашему <code>Gemfile</code>, нам необходимо запустить <code>rake</code> используя <code>bundle exec</code>. (Если вы, в соответствии с рекомендациями в <a class="ref" href="beginning#sec-install_ruby">Разделе&nbsp;1.2.2.3</a>, используете RVM, вы можете опускать <code>bundle exec</code>. Для того чтобы узнать об альтернативных способах избавления от <code>bundle exec</code>, см. <a class="ref" href="static-pages#sec-eliminating_bundle_exec">Section&nbsp;3.6.1</a>.)</p>

<p>Теперь мы можем запустить локальный веб-сервер, используя <code>rails s</code>, что является сокращением для <code>rails server</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails s
</pre></div>
</div>


<p>При этом демонстрационное приложение уже должно быть готово по адресу <a href="http://localhost:3000/">http://localhost:3000/</a>.</p>

<div class="label" id="sidebar-rake"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.1.</span><span class="description">Rake</span></span>
<p>В традиции Unix, <a  href="http://ru.wikipedia.org/wiki/Make"><em>make</em></a> утилита играет важную роль в сборке исполняемых программ из исходного кода; множество компьютерных хакеров зафиксировали в мышечной памяти строку</p>

<pre class="verbatim">  $ ./configure &amp;&amp; make &amp;&amp; sudo make install</pre>


<p>обычно используемую, для компиляции кода на Unix системах (включая Linux и Mac OS&nbsp;X).</p>

<p>Rake это <em>Ruby make</em>, make-подобный язык написанный на Ruby. Rails использует Rake, в значительной степени, специально для неисчислимых небольших административных задач, необходимых при разработке поддерживаемых базой данных веб-приложений. <code>rake db:migrate</code> команда, вероятно, наиболее распространена, но есть и многие другие; можно увидеть список задач базы данных, используя <code>-T db</code>:</p>

<pre class="verbatim">$ bundle exec rake -T db</pre>


<p>Чтобы увидеть все доступные Rake задачи, запустите</p>

<pre class="verbatim">$ bundle exec rake -T</pre>


<p>Список, вероятно, будет подавляющим, но не волнуйтесь, вы  не должны знать все (или даже большую часть) этих команд. К концу  <em>Учебника Rails</em>, вы  будете знать все самые важные.</p>
</div>




<div class="label" id="sec-a_user_tour"></div>


<h3><a id="sec-2_2_1" href="a-demo-app#sec-a_user_tour" class="heading"><span class="number">2.2.1</span> Обзор пользователя</a></h3>


<p>При посещении корневого url&nbsp;<a href="http://localhost:3000/">http://localhost:3000/</a> мы видим ту же самую дефолтную страницу Rails, что и на <a class="ref" href="beginning#fig-riding_rails">Рис.&nbsp;1.3</a>, но при генерировании ресурса Users scaffolding-ом мы также создали большое количество страниц для управления пользователями. Например, страницу для отображения списка всех пользователей на <a href="http://localhost:3000/users">/users</a> и страницу для создания нового пользователя на <a href="http://localhost:3000/">/users/new</a>. Остальная часть этого раздела посвящена ураганному туру по этим страницам. В процессе этого тура для вас может оказаться полезным иногда поглядывать на <a class="ref" href="a-demo-app#table-user_urls">Таблицу&nbsp;2.1</a>, которая показывает соответствие между страницами и их URL.</p>

<div class="label" id="table-user_urls"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><a href="http://localhost:3000/users">/users</a></td><td class="align_left"><code>index</code></td><td class="align_left">страница, для отображения списка всех пользователей</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1">/users/1</a></td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая пользователя с id <code>1</code></td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/new">/users/new</a></td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового пользователя</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1/edit">/users/1/edit</a></td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.1: </span><span class="description">Cоответствие между страницами и URL для ресурса Users.</span></div></div>


<p>Мы начнем со страницы показывающей всех пользователей в нашем приложении, называемой <a href="http://localhost:3000/users"><tt>index</tt></a>; как вы могли бы ожидать, изначально там нет никаких пользователей (<a class="ref" href="a-demo-app#fig-demo_blank_user_index_rails_3">Рис.&nbsp;2.4</a>).</p>

<div class="label" id="fig-demo_blank_user_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_blank_user_index_rails_3.png" alt="demo_blank_user_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.4: </span><span class="description">Начальная index страница для ресурса Users (<a href="http://localhost:3000/users">/users</a>).&nbsp;<a href="/images/figures/demo_blank_user_index_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Для того, чтобы создать нового пользователя мы посещаем <a href="http://localhost:3000/users/new"><tt>new</tt></a> страницу, как показано на <a class="ref" href="a-demo-app#fig-demo_new_user_rails_3">Рис.&nbsp;2.5</a>. (Поскольку http://localhost:3000 часть адреса явно будет повторятся до тех пор пока мы разрабатываем локально, я буду обычно опускать ее с этого момента.) В <a class="ref" href="sign-up#top">Главе&nbsp;7</a> это станет страницей регистрации пользователя.</p>


<div class="label" id="fig-demo_new_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_user_rails_3.png" alt="demo_new_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.5: </span><span class="description">Страница создания нового пользователя (<a href="http://localhost:3000/users/new">/users/new</a>).&nbsp;<a href="/images/figures/demo_new_user_rails_3-full.png#">(полный размер)</a></span></div></div>



<p>Мы можем создать пользователя, введя значения имени и адреса электронной почты в текстовые поля и нажав затем кнопку Create User. Результат - страница <a href="http://localhost:3000/users/1"><tt>show</tt></a> как видно на <a class="ref" href="a-demo-app#fig-demo_show_user_rails_3">Рис.&nbsp;2.6</a>. (Зеленое приглашающее сообщение выполняется с использованием <em>флэш</em>, о котором мы узнаем в <a class="ref" href="sign-up#sec-the_flash">Разделе&nbsp;7.4.2</a>.) Отметим, что в URL <a href="http://localhost:3000/users/1">/users/1</a>;  как вы  могли бы подозревать, цифра&nbsp;<code>1</code> это просто атрибут&nbsp;<code>id</code> пользователя из <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a>. В <a class="ref" href="sign-up#sec-showing_users">Разделе&nbsp;7.1</a>эта страница станет профилем пользователя.</p>

<div class="label" id="fig-demo_show_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_show_user_rails_3.png" alt="demo_show_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.6: </span><span class="description">Страница показывающая пользователя (<a href="http://localhost:3000/users/1">/users/1</a>).&nbsp;<a href="/images/figures/demo_show_user_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Для того, чтобы изменить информацию пользователя, мы посещаем страницу <a href="http://localhost:3000/users/1/edit"><tt>edit</tt></a> (<a class="ref" href="a-demo-app#fig-demo_edit_user_rails_3">Рис.&nbsp;2.7</a>). Изменяя информацию о пользователе и нажимая кнопку Update User, мы изменяем информацию о пользователе в демонстрационном приложении (<a class="ref" href="a-demo-app#fig-demo_update_user_rails_3">Рис.&nbsp;2.8</a>). (Как мы увидим в <a class="ref" href="modeling-users#top">Главе&nbsp;6</a>, эти данные пользователя хранятся в бэкэнде базы данных.) Мы добавим функции edit/update (редактировать/обновить) пользователя к примеру приложения в <a class="ref" href="updating-showing-and-deleting-users#sec-updating_users">Разделе&nbsp;9.1</a>.</p>

<div class="label" id="fig-demo_edit_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_edit_user_rails_3.png" alt="demo_edit_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.7: </span><span class="description">Страница  редактирования пользователя (<a href="http://localhost:3000/users/1/edit">/users/1/edit</a>).&nbsp;<a href="/images/figures/demo_edit_user_rails_3-full.png#">(полный размер)</a></span></div></div>




<div class="label" id="fig-demo_update_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_update_user_rails_3.png" alt="demo_update_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.8: </span><span class="description">Пользователь с обновленной информацией.&nbsp;<a href="/images/figures/demo_update_user_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Теперь мы создадим второго пользователя, повторно посетив <a href="http://localhost:3000/users/new"><tt>new</tt></a> страницу и предоставив второй набор информации о пользователе; получившаяся страница <a href="http://localhost:3000/users"><tt>index</tt></a> показана на <a class="ref" href="a-demo-app#fig-demo_user_index_two_rails_3">Рис.&nbsp;2.9</a>. <a class="ref" href="sign-up#sec-showing_users">Раздел&nbsp;7.1</a> преобразует список пользователей в более отполированную страницу для демонстрации всех пользователей.</p>

<div class="label" id="fig-demo_user_index_two_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_index_two_rails_3.png" alt="demo_user_index_two_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.9: </span><span class="description">Страница-список пользователей (<a href="http://localhost:3000/users">/users</a>) с вторым пользователем.&nbsp;<a href="/images/figures/demo_user_index_two_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Показав как создавать, отображать и редактировать пользователей, мы переходим, наконец, к их удалению (<a class="ref" href="a-demo-app#fig-demo_destroy_user_rails_3">Рис.&nbsp;2.10</a>). Следует проверить, что клик по ссылке показанной на <a class="ref" href="a-demo-app#fig-demo_destroy_user_rails_3">Рис.&nbsp;2.10</a> уничтожает второго пользователя, приводя к index странице с одним пользователем. (Если это не работает, убедитесь, что JavaScript включен в вашем браузере; Rails использует JavaScript, чтобы выдать запрос, который должен уничтожить пользователя.) <a class="ref" href="updating-showing-and-deleting-users#sec-destroying_users">Раздел&nbsp;9.4</a> добавляет удаление пользователя к демонстрационному приложению, заботясь об ограничении его использования специальным классом административных пользователей.</p>

<div class="label" id="fig-demo_destroy_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_destroy_user_rails_3.png" alt="demo_destroy_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.10: </span><span class="description">Уничтожение пользователя.&nbsp;<a href="/images/figures/demo_destroy_user_rails_3-full.png#">(полный размер)</a></span></div></div>




<div class="label" id="sec-mvc_in_action"></div>


<h3><a id="sec-2_2_2" href="a-demo-app#sec-mvc_in_action" class="heading"><span class="number">2.2.2</span> MVC в действии</a></h3>


<p>Теперь, когда мы завершили быстрый обзор ресурса Пользователи (Users), давайте исследуем одну его определенную часть в контексте паттерна Модель-Представление-Контроллер (MVC) частично представленного в  <a class="ref" href="beginning#sec-mvc">Разделе&nbsp;1.2.6</a>. Наша стратегия будет состоять в том, чтобы описать результаты типичного запроса браузера: посещение index страницы пользователя на <a href="http://localhost:3000/users">/users</a>&mdash;в терминах MVC (<a class="ref" href="a-demo-app#fig-mvc_detailed">Рис.&nbsp;2.11</a>).</p>

<div class="label" id="fig-mvc_detailed"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/mvc_detailed.png" alt="mvc_detailed" /></span></div><div class="caption"><span class="header">Рис. 2.11: </span><span class="description">Подробная схема MVC в Rails.&nbsp;<a href="/images/figures/mvc_detailed-full.png#">(полный размер)</a></span></div></div>




<ol>
<li>Браузер выдает запрос на URL /users.</li>
<li>Rails направляет <tt>/users</tt> к <code>index</code> действию в контроллере Users.</li>
<li><code>Index</code> действие просит, чтобы модель User получила всех пользователей (<code>User.all</code>).</li>
<li>Модель User вытягивает всех пользователей из базы данных.</li>
<li>Модель User возвращает список пользователей в контроллер.</li>
<li>Контроллер получает пользователей в <code>@users</code> переменной, которую он передает <code>index</code> представлению.</li>
<li>Представление использует Embedded (Встроенный) Ruby, чтобы визуализировать страницу как HTML.</li>
<li>Контроллер возвращает HTML в браузер.<sup class="footnote" id="fnref-2_3"><a href="#fn-2_3">3</a></sup></li>
</ol>


<p>Мы начинаем с запроса, выданного браузером &mdash; то есть, с результата ввода URL в адресной строке или клика по ссылке (Шаг&nbsp;1 в <a class="ref" href="a-demo-app#fig-mvc_detailed">Рис.&nbsp;2.11</a>). Этот запрос вызывает <em>Rails маршрутизатор</em> (Шаг&nbsp;2), который отправляет к надлежащему <em>действию контроллера</em>, основываясь на URL (и, как мы увидим в <a class="ref" href="static-pages#sidebar-get_etc">Блоке&nbsp;3.3</a>, на типе запроса). Код, создающий перенаправление URL пользователя к действиям контроллера для ресурса Users представлен в <a class="ref" href="a-demo-app#code-rails_routes">Листинге&nbsp;2.2</a>; этот код  фактически устанавливает таблицу пар URL/Действие, которые мы видели в <a class="ref" href="a-demo-app#table-user_urls">Таблице&nbsp;2.1</a>. (Странная нотация <code>:users</code> это <em>symbol</em>, о котором мы узнаем в <a class="ref" href="rails-flavored-ruby#sec-hashes_and_symbols">Разделе&nbsp;4.3.3</a>.)</p>

<div class="label" id="code-rails_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.2.</span> <span class="description">Маршруты Rails, с правилом для ресурса Users. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">DemoApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Страницы из <a class="ref" href="a-demo-app#sec-a_user_tour">Раздела&nbsp;2.2.1</a> соответствуют <em>действиям</em> в <em>контроллере</em> Users, который является набором связанных действий; контроллер, сгенерированный scaffolding, схематично показан в <a class="ref" href="a-demo-app#code-demo_users_controller">Листинге&nbsp;2.3</a>. Отметьте запись <code>class UsersController &lt; ApplicationController</code>; это  пример Ruby <em>класса</em> с <em>наследованием</em>. (Мы  вкратце обсудим наследование в <a class="ref" href="a-demo-app#sec-inheritance_hierarchies">Разделе&nbsp;2.3.4</a> и раскроем обе темы более подробно в <a class="ref" href="rails-flavored-ruby#sec-ruby_classes">Разделе&nbsp;4.4</a>.)</p>

<div class="label" id="code-demo_users_controller"></div>

<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.3.</span> <span class="description">Контроллер Users в схематичной форме. <br /> <code>app/controllers/users_controller.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Вы могли заметить, что действий больше чем страниц; <code>index</code>, <code>show</code>, <code>new</code>, и <code>edit</code> действия - все они соответствуют страницам из <a class="ref" href="a-demo-app#sec-a_user_tour">Раздела&nbsp;2.2.1</a>, но есть также дополнительные <code>create</code> (создать), <code>update</code> (обновить), и <code>destroy</code> (разрушить) действия. Эти действия обычно не визуализируют страниц (хотя иногда могут); вместо этого, их основная цель состоит в том, чтобы изменять информацию о пользователях в базе данных. Этот полный комплект действий контроллера, сведенный в <a class="ref" href="a-demo-app#table-demo_RESTful_users">Таблицу&nbsp;2.2</a>, представляет реализацию архитектуры REST в Rails (<a class="ref" href="a-demo-app#sidebar-REST">Блок&nbsp;2.2</a>), которая опирается на идеи <em>передачи состояния представления</em> идентифицированные и названые ученым <a href="http://en.wikipedia.org/wiki/Roy_Fielding">Roy Fielding</a>.<sup class="footnote" id="fnref-2_4"><a href="#fn-2_4">4</a></sup> Отметьте в <a class="ref" href="a-demo-app#table-demo_RESTful_users">Таблице&nbsp;2.2</a> что есть некоторое наложение в URLs; например, и <code>show</code> и <code>update</code> действиям соответствует URL /users/1. Различие между ними в <a  href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методе запроса HTTP</a> на который они отвечают. Мы узнаем больше о методах запроса HTTP в <a class="ref" href="static-pages#sec-TDD">Разделе&nbsp;3.2.1</a>.</p>

<div class="label" id="table-demo_RESTful_users"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left">/users</td><td class="align_left"><code>index</code></td><td class="align_left">страница со списком всех пользователей</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/new</td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового пользователя</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left">/users</td><td class="align_left"><code>create</code></td><td class="align_left">создание нового пользователя</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/1/edit</td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>PATCH</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>update</code></td><td class="align_left">обновление пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.2: </span><span class="description">RESTful маршруты предоставленные ресурсом Users в <a class="ref" href="a-demo-app#code-rails_routes">Листинге&nbsp;2.2</a>.</span></div></div>




<div class="label" id="sidebar-REST"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.2.</span><span class="description">REpresentational State Transfer (REST, </a href="http://ru.wikipedia.org/wiki/REST">«передача состояния представления»</a>)</span></span>
<p>Если вы  много читали о веб-разработке на Ruby on Rails, вы  видели много ссылок на &ldquo;REST&rdquo;, являющуюся акронимом для REpresentational State Transfer («передача состояния представления»). REST - архитектурный стиль для разработки распределенных, сетевых систем и приложений, таких как World Wide Web и веб-приложения. Хотя теория REST довольно абстрактна, в контексте Rails приложений REST означает, что большинство компонентов приложения (таких как пользователи и микросообщения) моделируются как <em>ресурсы</em>, которые могут быть созданы (Сreated), прочитаны (Read), обновлены (Updated), и удалены (Deleted) - операции, которые соответствуют и <a href="http://ru.wikipedia.org/wiki/CRUD">операциям CRUD, реляционных баз данных</a> и четырем фундаментальным <a href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методам запроса HTTP</a>: <tt>POST</tt>, <tt>GET</tt>, <tt>PATCH</tt>, и <tt>DELETE</tt>. (Мы узнаем больше о запросах HTTP в <a class="ref" href="static-pages#sec-TDD">Разделе&nbsp;3.2.1</a> и особенно в <a class="ref" href="static-pages#sidebar-get_etc">Блоке&nbsp;3.3</a>.)</p>

<p>Как разработчику Rails приложений, RESTful стиль разработки помогает вам определиться какие контроллеры и действия писать: вы  просто структурируете приложение, используя ресурсы, которые создаются, читаются, обновляются, и удаляются. В случае пользователей и микросообщений, этот процесс является простым, так как они - натуральные ресурсы по определению. В <a class="ref" href="following-users#top">Главе&nbsp;11</a>мы увидим пример, где принципы REST позволяют нам моделировать более тонкую проблему &ldquo;Слежения за сообщениями пользователей&rdquo; естественным и удобным способом.</p>
</div>


<p>Чтобы исследовать отношения между контроллером Users и моделью User, давайте сосредоточимся на упрощенной версии <code>index</code> действия, показанной в <a class="ref" href="a-demo-app#code-demo_index_action">Листинге&nbsp;2.4</a>. (Код scaffold уродливый и запутанный, так что я опустил большую его часть.)</p>

<div class="label" id="code-demo_index_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.4.</span> <span class="description">Упрощенное index  действие для демонстрационного приложения. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>У этого <code>index</code> действия есть строка <code>@users = User.all</code> (Шаг&nbsp;3), которая просит, чтобы модель User получила список всех пользователей из базы данных (Шаг&nbsp;4), и затем помещает их в переменную  <code>@users</code> (произносится &ldquo;at-users&rdquo;) (Шаг&nbsp;5). Сама модель User появляется в <a class="ref" href="a-demo-app#code-demo_user_model">Листинге&nbsp;2.5</a>; хотя она довольно проста, к ней прилагается большое количество функций из-за наследования (<a class="ref" href="a-demo-app#sec-inheritance_hierarchies">Раздел&nbsp;2.3.4</a> и <a class="ref" href="rails-flavored-ruby#sec-ruby_classes">Раздел&nbsp;4.4</a>). В частности, за счет использования Rails библиотеки <em>Active Record</em>,  код в <a class="ref" href="a-demo-app#code-demo_user_model">Листинге&nbsp;2.5</a> заставляет <code>User.all</code> возвратить всех пользователей.</p>

<div class="label" id="code-demo_user_model"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.5.</span> <span class="description">Модель User для демонстрационного приложения. <br /> <code>app/models/user.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Как только <code>@users</code> переменная определена, контроллер вызывает <em>представление </em> (Шаг&nbsp;6), показанное в <a class="ref" href="a-demo-app#code-demo_index_view">Листинге&nbsp;2.6</a>. Переменные, которые начинаются со знака <code>@</code>, называемые <em>переменными экземпляра</em>, автоматически доступны в представлении; в данном случае, представление <code>index.html.erb</code> в <a class="ref" href="a-demo-app#code-demo_index_view">Листинге&nbsp;2.6</a> перебирает  список <code>@users</code> и выводит строку HTML для каждого. (Помните, вы не должны пытаться понять этот код прямо сейчас. Он показан только для иллюстрации.)</p>

<div class="label" id="code-demo_index_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.6.</span> <span class="description">Представление для index. <br /> <code>app/views/users/index.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Listing users<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

<span class="cp">&lt;%</span> <span class="vi">@users</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Show&#39;</span><span class="p">,</span> <span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">edit_user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Destroy&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span>
                                     <span class="ss">data:</span> <span class="p">{</span> <span class="ss">confirm:</span> <span class="s1">&#39;Are you sure?&#39;</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New User&#39;</span><span class="p">,</span> <span class="n">new_user_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>Представление преобразует свое содержимое в HТML (Шаг&nbsp;7), который затем возвращается контроллером в браузер для отображения (Шаг&nbsp;8).</p>

<div class="label" id="sec-weaknesses_of_this_users_resource"></div>


<h3><a id="sec-2_2_3" href="a-demo-app#sec-weaknesses_of_this_users_resource" class="heading"><span class="number">2.2.3</span> Недостатки данного Users ресурса</a></h3>


<p>Несмотря на полезность для общего обзора Rails, scaffold-ный ресурс Users имеет много серьезных недостатков.</p>

<ul>
<li><strong>Нет валидации данных.</strong> Наша модель User  безропотно принимает такие данные как пустые имена и недопустимые адреса электронной почты.</li>
<li><strong>Нет аутентификации.</strong> У нас нет понятия регистрации, и нет способа воспрепятствовать тому, чтобы любой пользователь выполнил любую операцию.</li>
<li><strong>Нет тестов.</strong> Что, технически, не вполне верно &mdash; scaffolding включает рудиментарные тесты &mdash; но сгенерированные тесты уродливы и негибки, и они не тестируют на подтверждение правильности данных, аутентификацию, или какие нибудь другие пользовательские потребности.</li>
<li><strong>Нет макета.</strong> Нет сколь-нибудь связанного стиля сайта или навигации.</li>
<li><strong>Нет реального понимания.</strong> Если вы понимаете код scaffold-а, вам, вероятно, не стОит читать эту книгу.</li>
</ul>




<div class="label" id="sec-microposts_resource"></div>


<h2><a id="sec-2_3" href="a-demo-app#sec-microposts_resource" class="heading"><span class="number">2.3</span> Ресурс Microposts</a></h2>


<p>Сгенерировав и исследовав ресурс Users, мы поворачиваемся теперь к связанному с ним ресурсу Microposts. На протяжении этого раздела я рекомендую сравнивать элементы ресурса Microposts с аналогичными элементами User из <a class="ref" href="a-demo-app#sec-demo_users_resource">Раздела&nbsp;2.2</a>; вы должны увидеть, что эти два ресурса во многом параллельны друг другу. RESTful структура Rails приложений лучше всего усваивается посредством наблюдения за подобными повторяющимися формами; действительно, наблюдение параллельной структуры Users и Microposts даже на этой ранней стадии является одной из причин написания этой главы. (Как мы увидим, написание приложения, более устойчивого, нежели игрушечный пример в этой главе, требует значительных усилий &mdash; мы не увидим ресурс Microposts до <a class="ref" href="user-microposts#top">Главы&nbsp;10</a> &mdash; и я не хотел так надолго откладывать его первое появление.)</p>

<div class="label" id="sec-a_micropost_microtour"></div>


<h3><a id="sec-2_3_1" href="a-demo-app#sec-a_micropost_microtour" class="heading"><span class="number">2.3.1</span> Микрообзор микросообщений</a></h3>


<p>Как и с ресурсом Users, мы генерируем код scaffold для ресурса Microposts, используя <code>rails generate scaffold</code>, в этом случае реализуя модель данных из <a class="ref" href="a-demo-app#fig-demo_micropost_model">Рис.&nbsp;2.3</a>:<sup class="footnote" id="fnref-2_5"><a href="#fn-2_5">5</a></sup></p>

<div class="code"><div class="highlight"><pre>$ rails generate scaffold Micropost content:string user_id:integer
      invoke  active_record
      create    db/migrate/20130307005528_create_microposts.rb
      create    app/models/micropost.rb
      invoke    test_unit
      create      test/models/micropost_test.rb
      create      test/fixtures/microposts.yml
      invoke  resource_route
       route    resources :microposts
      invoke  jbuilder_scaffold_controller
      create    app/controllers/microposts_controller.rb
      invoke    erb
      create      app/views/microposts
      create      app/views/microposts/index.html.erb
      create      app/views/microposts/edit.html.erb
      create      app/views/microposts/show.html.erb
      create      app/views/microposts/new.html.erb
      create      app/views/microposts/_form.html.erb
      invoke    test_unit
      create      test/controllers/microposts_controller_test.rb
      invoke    helper
      create      app/helpers/microposts_helper.rb
      invoke      test_unit
      create        test/helpers/microposts_helper_test.rb
      invoke    jbuilder
       exist      app/views/microposts
      create      app/views/microposts/index.json.jbuilder
      create      app/views/microposts/show.json.jbuilder
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/microposts.js.coffee
      invoke    scss
      create      app/assets/stylesheets/microposts.css.scss
      invoke  scss
   identical    app/assets/stylesheets/scaffolds.css.scss
</pre></div>
</div>


<p>Чтобы обновить нашу базу данных с новой моделью данных, мы должны запустить миграцию как в <a class="ref" href="a-demo-app#sec-demo_users_resource">Разделе&nbsp;2.2</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake db:migrate
<span class="go">==  CreateMicroposts: migrating ===============================================</span>
<span class="go">-- create_table(:microposts)</span>
<span class="go">   -&gt; 0.0023s</span>
<span class="go">==  CreateMicroposts: migrated (0.0026s) ======================================</span>
</pre></div>
</div>


<p>Теперь мы имеем возможность создавать микропосты тем же образом, каким мы создавали пользователей в <a class="ref" href="a-demo-app#sec-a_user_tour">Разделе&nbsp;2.2.1</a>. Как вы могли бы предположить, генератор scaffold добавил в файл маршрутов Rails правило для ресурса Microposts, как видно в <a class="ref" href="a-demo-app#code-demo_microposts_resource">Листинге&nbsp;2.7</a>.<sup class="footnote" id="fnref-2_6"><a href="#fn-2_6">6</a></sup> Как и с users, <code>resources :microposts</code> маршрутное правило направляет URL микросообщений на действия в контроллере Microposts, как видно в <a class="ref" href="a-demo-app#table-demo_RESTful_microposts">Таблице&nbsp;2.3</a>.</p>

<div class="label" id="code-demo_microposts_resource"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.7.</span> <span class="description">Маршруты Rails с новым правилом для ресурсов Microposts. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">DemoApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:microposts</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="table-demo_RESTful_microposts"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts</td><td class="align_left"><code>index</code></td><td class="align_left">страница со списком всех микросообщений</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts/1</td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая микросообщение с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts/new</td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового микросообщения</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left">/microposts</td><td class="align_left"><code>create</code></td><td class="align_left">создание нового микросообщения</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts/1/edit</td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>PATCH</tt></td><td class="align_left">/microposts/1</td><td class="align_left"><code>update</code></td><td class="align_left">обновление микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left">/microposts/1</td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление микросообщения с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.3: </span><span class="description">RESTful маршруты, обеспеченные ресурсом Microposts в <a class="ref" href="a-demo-app#code-demo_microposts_resource">Листинге&nbsp;2.7</a>.</span></div></div>


<p>Сам Microposts контроллер в схематичной форме представлен в <a class="ref" href="a-demo-app#code-demo_microposts_controller">Листинге&nbsp;2.8</a>. Отметьте, что, кроме наличия <code>MicropostsController</code> вместо <code>UsersController</code>, <a class="ref" href="a-demo-app#code-demo_microposts_controller">Листинг&nbsp;2.8</a> <em>идентичен</em> коду в <a class="ref" href="a-demo-app#code-demo_users_controller">Листинге&nbsp;2.3</a>. Это отражение REST архитектуры, характерной для обоих ресурсов.</p>

<div class="label" id="code-demo_microposts_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.8.</span> <span class="description">Контроллер Microposts в схематичной форме. <br /> <code>app/controllers/microposts_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>для того чтобы сделать несколько настоящих микросообщений, мы вводим информацию на new странице микросообщений, <a href="http://localhost:3000/microposts/new">/microposts/new</a> как видно на <a class="ref" href="a-demo-app#fig-demo_new_micropost_rails_3">Рис.&nbsp;2.12</a>.</p>

<div class="label" id="fig-demo_new_micropost_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_micropost_rails_3.png" alt="demo_new_micropost_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.12: </span><span class="description">Страница для создания микросообщений (<a href="http://localhost:3000/microposts/new">/microposts/new</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_new_micropost-full.png">(полный размер)</a></span></div></div>


<p>Теперь создайте одно - два микросообщения,  удостоверьтесь, чтобы по крайней мере у одного из них был <code>user_id</code>&nbsp;=&nbsp;<code>1</code> для сопоставления с id первого пользователя, созданного в <a class="ref" href="a-demo-app#sec-a_user_tour">Разделе&nbsp;2.2.1</a>. Результат должен быть похож на <a class="ref" href="a-demo-app#fig-demo_micropost_index_rails_3">Рис.&nbsp;2.13</a>.</p>

<div class="label" id="fig-demo_micropost_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_index_rails_3.png" alt="demo_micropost_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.13: </span><span class="description">Страница списка микросообщений (<a href="http://localhost:3000/microposts">/microposts</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_micropost_index_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-putting_the_micro_in_microposts"></div>


<h3><a id="sec-2_3_2" href="a-demo-app#sec-putting_the_micro_in_microposts" class="heading"><span class="number">2.3.2</span> Помещение <em>микро</em> в микросообщения</a></h3>


<p>Каждое <em>микро</em>сообщение, достойное своего имени, должно иметь некоторые средства предписания длины сообщения. Реализация этого ограничения в Rails легка с <em>проверками допустимости</em> (валидациями); чтобы принять микросообещния длиной не более 140 символов (а-ля Twitter), мы используем проверку допустимости (валидацию) <em>длины</em>. В этой точке следует открыть файл <code>app/models/micropost.rb</code> в вашем текстовом редакторе или IDE и заполнить его содержимым <a class="ref" href="a-demo-app#code-demo_length_validation">Листинга&nbsp;2.9</a>. (Использование <em>валидации</em> из <a class="ref" href="a-demo-app#code-demo_length_validation">Листинга&nbsp;2.9</a> характерно для Rails&nbsp;3; если вы ранее работали с Rails&nbsp;2.3, следует сравнить это с использованием <code>validates_length_of</code>.)</p>

<div class="label" id="code-demo_length_validation"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.9.</span> <span class="description">Ограничение микросообщений максимумом в 140 знаков посредством валидации длины. <br /> <code>app/models/micropost.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">length:</span> <span class="p">{</span> <span class="ss">maximum:</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Код в <a class="ref" href="a-demo-app#code-demo_length_validation">Листинге&nbsp;2.9</a> может выглядеть довольно таинственно &mdash; мы рассмотрим валидацию более тщательно  в <a class="ref" href="modeling-users#sec-user_validations">Разделе&nbsp;6.2</a> &mdash; но его эффект станет вполне очевиден, если мы перейдем в новую страницу микросообщений и введем больше чем 140 символов для контента сообщения. Как видно на <a class="ref" href="a-demo-app#fig-micropost_length_error_rails_3">Рис.&nbsp;2.14</a>, Rails выдает <em>сообщение об ошибке</em> указывающее на то, что контент микросообщения является слишком длинным. (Мы узнаем больше о сообщениях об ошибках в  <a class="ref" href="sign-up#sec-signup_error_messages">Разделе&nbsp;7.3.3</a>.)</p>

<div class="label" id="fig-micropost_length_error_rails_3"></div>

<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_length_error_rails_3.png" alt="micropost_length_error_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.14: </span><span class="description">Сообщение об ошибке для неудачно созданного микросообщения.&nbsp;<a href="http://railstutorial.org/images/figures/micropost_length_error_rails_3-full.png">(полный размер)</a></span></div></div>

<div class="label" id="sec-demo_user_has_many_microposts"></div>


<h3><a id="sec-2_3_3" href="a-demo-app#sec-demo_user_has_many_microposts" class="heading"><span class="number">2.3.3</span> A user <code>has_many</code> microposts (Пользователь <code>имеет_много</code> микросообщений)</a></h3>


<p>Одна из наиболее мощных функций Rails &#8211; возможность формировать <em>связи</em> между различными моделями данных. В случае нашей модели User  у каждого пользователя потенциально есть много микросообщений. Мы можем выразить это в коде, обновив модели User и Micropost как это показано в <a class="ref" href="a-demo-app#code-demo_user_has_many_microposts">Листинге&nbsp;2.10</a> и <a class="ref" href="a-demo-app#code-demo_micropost_belongs_to_user">Листинге&nbsp;2.11</a>.</p>

<div class="label" id="code-demo_user_has_many_microposts"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.10.</span> <span class="description">У пользователя есть много микросообщений (user has many microposts). <br /> <code>app/models/user.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="n">has_many</span> <span class="ss">:microposts</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_micropost_belongs_to_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.11.</span> <span class="description">Микросообщения принадлежат пользователю (micropost belongs to a user). <br /> <code>app/models/micropost.rb</code></span></div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">length:</span> <span class="p">{</span> <span class="ss">maximum:</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Мы можем увидеть результат применения этой ассоциации на <a class="ref" href="a-demo-app#fig-micropost_user_association">Рис.&nbsp;2.15</a>. Из-за <code>user_id</code> столбца в таблице <code>microposts</code> Rails (используя Active Record) может вывести микросообщения, связанные с каждым пользователем.</p>

<div class="label" id="fig-micropost_user_association"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_user_association.png" alt="micropost_user_association" /></span></div><div class="caption"><span class="header">Рис. 2.15: </span><span class="description">Связь между микросообщениями и пользователями.</span></div></div>


<p>В <a class="ref" href="user-microposts#top">Главе&nbsp;10</a> и <a class="ref" href="following-users#top">Главе&nbsp;11</a>, мы будем использовать ассоциацию пользователей и микросообщений и чтобы вывести на экран все микросообщения пользователя, и чтобы создать Twitter-подобную подачу микросообщений. Пока, мы можем исследовать применение связи микросообщения-пользователь с помощью <em>консоли</em>, которая является полезным инструментом для взаимодействия с Rails приложениями. Сначала мы вызовем консоль командой <code>rails console</code> в командной строке, а затем получим первого пользователя из базы данных, используя <code>User.first</code> (поместив результаты в переменную <code>first_user</code>):<sup class="footnote" id="fnref-2_7"><a href="#fn-2_7">7</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; #&lt;User id: 1, name: &quot;Michael Hartl&quot;, email: &quot;michael@example.org&quot;,</span>
<span class="go">created_at: &quot;2013-03-06 02:01:31&quot;, updated_at: &quot;2013-03-06 02:01:31&quot;&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span><span class="o">.</span><span class="n">microposts</span>
<span class="go">=&gt; [#&lt;Micropost id: 1, content: &quot;First micropost!&quot;, user_id: 1, created_at:</span>
<span class="go">&quot;2013-03-06 02:37:37&quot;, updated_at: &quot;2013-03-06 02:37:37&quot;&gt;, #&lt;Micropost id: 2,</span>
<span class="go">content: &quot;Second micropost&quot;, user_id: 1, created_at: &quot;2013-03-06 02:38:54&quot;,</span>
<span class="go">updated_at: &quot;2013-03-06 02:38:54&quot;&gt;]</span>
<span class="gp">&gt;&gt; </span><span class="nb">exit</span>
</pre></div>
</div>


<p>(Я включил последнюю строку только чтобы продемонстрировать, как выйти из консоли, и на большинстве систем вы можете использовать Ctrl-d с этой же целью.) Здесь мы получили доступ к микросообщениям пользователя, используя код <code>first_user.microposts</code>: с этим кодом Active Record автоматически возвращает все микросообщения с <code>user_id</code> равным id <code>first_user</code> (в данном случае,&nbsp;<code>1</code>). Мы узнаем намного больше о возможностях ассоциаций (связей) Active Record в <a class="ref" href="user-microposts#top">Главе&nbsp;10</a> и <a class="ref" href="following-users#top">Главе&nbsp;11</a>.</p>

<div class="label" id="sec-inheritance_hierarchies"></div>


<h3><a id="sec-2_3_4" href="a-demo-app#sec-inheritance_hierarchies" class="heading"><span class="number">2.3.4</span> Иерархия наследования</a></h3>


<p>Мы закончим наше обсуждение демонстрационного приложения кратким описанием иерархии классов контроллеров и моделей в Rails. Это обсуждение будет иметь много смысла, только если у вас был некоторый опыт объектно-ориентированного программирования (ООП); если вы не изучали ООП, не стесняйтесь пропустить этот раздел. В частности, если вы не знакомы с <em>классами</em> (обсуждаемыми в <a class="ref" href="rails-flavored-ruby#sec-ruby_classes">Разделе&nbsp;4.4</a>), я предлагаю вернуться к этому разделу позже.</p>

<p>Мы начнем со структуры наследования для моделей. Сравнивая <a class="ref" href="a-demo-app#code-demo_user_class">Листинг&nbsp;2.12</a> с <a class="ref" href="a-demo-app#code-demo_micropost_class">Листингом&nbsp;2.13</a>, мы видим, что и модель User и модель Micropost наследовались (через левую угловую скобку&nbsp;<code>&lt;</code>) от <code>ActiveRecord::Base</code>, который является базовым классом для моделей, предоставляемых библиотекой ActiveRecord; схема, резюмирующая это отношение, представлена на <a class="ref" href="a-demo-app#fig-demo_model_inheritance">Рис.&nbsp;2.16</a>. Благодаря наследованию от <code>ActiveRecord::Base</code> наши объекты модели получают возможность связываться с базой данных, обрабатывать столбцы базы данных как Ruby атрибуты и так далее.</p>

<div class="label" id="code-demo_user_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.12.</span> <span class="description">Класс <code>User</code>, с наследованием. <br /> <code>app/models/user.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_micropost_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.13.</span> <span class="description">Класс <code>Micropost</code> с наследованием. <br /> <code>app/models/micropost.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig-demo_model_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_model_inheritance.png" alt="demo_model_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.16: </span><span class="description">Иерархия наследования для моделей User и Micropost.</span></div></div>


<p>Структура наследования для контроллеров лишь немногим более сложная. Сравнивая <a class="ref" href="a-demo-app#code-demo_users_controller_class">Листинг&nbsp;2.14</a> с <a class="ref" href="a-demo-app#code-demo_microposts_controller_class">Листингом&nbsp;2.15</a>, мы видим, что и контроллер User и контроллер Micropost наследовались от Application controller. Исследуя <a class="ref" href="a-demo-app#code-demo_application_controller_class">Листинг&nbsp;2.16</a>, мы видим, что сам <code>ApplicationController</code> наследует от <code>ActionController::Base</code>;  это базовый класс для контроллеров, обеспеченных  Rails библиотекой Action Pack. Отношения между этими классами иллюстрируются в <a class="ref" href="a-demo-app#fig-demo_controller_inheritance">Рис.&nbsp;2.17</a>.</p>

<div class="label" id="code-demo_users_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.14.</span> <span class="description">Класс <code>UsersController</code>, с наследованием. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_microposts_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.15.</span> <span class="description">Класс <code>MicropostsController</code>, с наследованием. <br /> <code>app/controllers/microposts_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_application_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.16.</span> <span class="description">Класс <code>ApplicationController</code>, с наследованием. <br /> <code>app/controllers/application_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="ss">ActionController::Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig-demo_controller_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_controller_inheritance.png" alt="demo_controller_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.17: </span><span class="description">Иерархия наследования для контроллеров Users и Microposts.</span></div></div>


<p>Как и с наследованием моделей, будучи, в конечном счете, наследниками  <code>ActionController::Base</code> и Users и Microposts контроллеры имеют большое количество функций, таких как возможность управлять объектами модели, фильтровать входящие запросы HTTP, и визуализировать представления как HTML. Так как все контроллеры Rails наследовались от <code>ApplicationController</code>, правила, определенные в ApplicationController автоматически, применяются к каждому действию в приложении. Например, в <a class="ref" href="sign-in-sign-out#sec-remember_me">Разделе&nbsp;8.2.1</a> мы увидим как включить хелперы для входа и выхода во все контроллеры примера приложения.</p>

<div class="label" id="sec-deploying_the_demo_app"></div>


<h3><a id="sec-2_3_5" href="a-demo-app#sec-deploying_the_demo_app" class="heading"><span class="number">2.3.5</span> Развертывание демонстационного приложения</a></h3>


<p>Закончив ресурс Microposts, мы можем отправить репозиторий на GitHub:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Finish demo app&quot;</span>
<span class="gp">$</span> git push
</pre></div>
</div>


<p>Обычно вам следует делать более частые коммиты, но для этой главы единственный большой коммит в конце - это вполне нормально.</p>

<p>Можно также развернуть demo app на Heroku как и в <a class="ref" href="beginning#sec-deploying">Разделе&nbsp;1.4</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
</pre></div>
</div>


<p>(Как было отмечено в <a class="ref" href="beginning#sec-heroku_setup">Разделе&nbsp;1.4.1</a>, некоторые читатели сообщали о необходимости прекомпиляции ассетов при помощи команды:</p>

<div class="code"><div class="highlight"><pre><span class="gp">#</span> Это должно быть использовано только <span class="k">если </span>вы не можете задеплоить на Heroku.
<span class="gp">$</span> rake assets:precompile
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Add precompiled assets for Heroku&quot;</span>
<span class="gp">$</span> git push heroku master
</pre></div>
</div>


<p>Шаг прекомпиляции ассетов по идее не нужен и я не смог воспроизвести ситуацию в которой он был бы необходим, но количество получаемых сообщений об ошибках таково что я вынужден упомянуть здесь о решении.)</p>

<p>Также необходимо запустить миграции продакшен базы данных:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku run rake db:migrate
</pre></div>
</div>


<p>Это обновит базу данных на Heroku с необходимой моделью данных.</p>

<h2><a id="sec-2_4" href="a-demo-app#sec-2_4" class="heading"><span class="number">2.4</span> Заключение</a></h2>


<p>Мы подошли к концу 9 144 метрового (30,000-foot ) обзора Rails приложения. У demo app, разработанного в этой главе, есть несколько достоинств и масса недостатков.</p>

<p><strong>Достоинства</strong></p>

<ul>
  <li>Общее представление о Rails</li>
  <li>Введение в MVC</li>
  <li>Первый вкус архитектуры REST</li>
  <li>Начальное моделирование данных</li>
  <li>Живое, поддерживаемое базой данных веб-приложение в production</li>
</ul>


<p><strong>Недостатки</strong></p>

<ul>
  <li>Нет собственного макета или стиля</li>
  <li>Нет статических страниц (таких как "Главная" или "О нас")</li>
  <li>Нет паролей пользователя</li>
  <li>Нет изображений пользователя</li>
  <li>Нет регистрации</li>
  <li>Нет безопасности</li>
  <li>Нет автоматической связи пользователь/микросообщение</li>
  <li>Нет понятий &ldquo;following&rdquo; или &ldquo;followed&rdquo;</li>
  <li>Нет потока (ленты) микросообщений</li>
  <li>Нет разработки через тестирование</li>
  <li><strong>Нет реального понимания</strong></li>
</ul>


<p>Остальная часть этого учебника посвящена усилению достоинств и устранению недостатков.</p>

<div class="navigation">  <a class="prev_page" href="beginning#top">
    &laquo;&nbsp;<span class="number">Глава 1</span> От нуля к развертыванию
  </a>
  <a class="next_page" href="static-pages#top">
    <span class="number">Глава 3</span> В основном статические страницы&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn-2_1">Моделируя более длинные сообщения,  для нормального (не микро) блога, следует использовать тип <code>text</code> вместо <code>string</code>.&nbsp;<a class="arrow" href="#fnref-2_1">&uarr;</a></li>
<li id="fn-2_2">Имя scaffold следует за соглашением в соответствии с которым, <em>модели</em> имеют единственное число, в отличие от ресурсов и контроллеров, которые используются во множественном числе. Таким образом, у нас есть <em>User</em> вместо <em>Users</em>.&nbsp;<a class="arrow" href="#fnref-2_2">&uarr;</a></li>
<li id="fn-2_3">Некоторые источники утверждают, что представление возвращает HTML непосредственно браузеру (через веб-сервер, такой как Apache или Nginx). Независимо от деталей реализации, я предпочитаю думать о контроллере как о центральном хабе через который проходят информационные потоки всего приложения.&nbsp;<a class="arrow" href="#fnref-2_3">&uarr;</a></li>
<li id="fn-2_4">Fielding, Roy Thomas. <em>Architectural Styles and the Design of Network-based Software Architectures</em>. Doctoral dissertation, University of California, Irvine, 2000.&nbsp;<a class="arrow" href="#fnref-2_4">&uarr;</a></li>
<li id="fn-2_5">Как и с User scaffold, генератор scaffold для микросообщений следует сингулярному соглашению для моделей Rails; таким образом, мы имеем, <code>generate Micropost</code>, а не <code>generate MicropostS</code>.&nbsp;<a class="arrow" href="#fnref-2_5">&uarr;</a></li>
<li id="fn-2_6">У кода scaffold могут быть дополнительные новые строки по сравнению с <a class="ref" href="a-demo-app#code-demo_microposts_resource">Листингом&nbsp;2.7</a>. Это не повод для беспокойства, поскольку Ruby игнорирует дополнительные новые строки.&nbsp;<a class="arrow" href="#fnref-2_6">&uarr;</a></li>
<li id="fn-2_7">Ваше приглашение командной строки, вероятно, будет чем-то вроде <code>ruby-2.0.0-head &gt;</code>, но я буду использовать&nbsp;<tt class="verb">&gt;&gt;</tt> поскольку версии Ruby могут отличаться.&nbsp;<a class="arrow" href="#fnref-2_7">&uarr;</a></li>
</ol>
</div>

    </div>
  <div id="book_bottom">
  </div>
</div>
</div><script type="text/javascript">
    var reformalOptions = {
        project_id: 36662,
        project_host: "RoR.reformal.ru",
        tab_orientation: "left",
        tab_indent: "50%",
        tab_bg_color: "#6b0508",
        tab_border_color: "#FFFFFF",
        tab_image_url: "http://tab.reformal.ru/T9GC0LfRi9Cy0Ysg0Lgg0L%252FRgNC10LTQu9C%252B0LbQtdC90LjRjw==/FFFFFF/4bfb34d91c8d7fb481972ca3c84aec38/left/0/tab.png",
        tab_border_width: 1
    };

    (function() {
        var script = document.createElement('script');
        script.type = 'text/javascript'; script.async = true;
        script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'media.reformal.ru/widgets/v3/reformal.js';
        document.getElementsByTagName('head')[0].appendChild(script);
    })();
</script>
<div class="orphus center"><script src="/javascripts/orphus.js" type="text/javascript"></script></div><!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
(function(w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter5083948 = new Ya.Metrika(5083948);
             yaCounter5083948.clickmap(true);
             yaCounter5083948.trackLinks(true);

        } catch(e) { }
    });
})(window, 'yandex_metrika_callbacks');
</script></div>
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript" defer="defer"></script>
<noscript><div><img src="//mc.yandex.ru/watch/5083948" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter --></div></div></body></html>}B) *      VV<MW   0:http://railstutorial.ru/chapters/4_0/a-demo-app necko:classified 1 request-method GET response-head HTTP/1.1 200 OK 
Cache-Control: public, max-age=86400
Content-Type: text/html; charset=utf-8
Etag: "3c16f3c0b14604551d5d58f62bdb033a"
x-ua-compatible: IE=Edge,chrome=1
X-Runtime: 0.026349
Server: WEBrick/1.3.1 (Ruby/2.2.2/2015-04-13)
Date: Sat, 02 Apr 2016 13:20:20 GMT
Content-Length: 157752
Via: 1.1 vegur
 charset UTF-8 uncompressed-len 0 predictor::resource-count 27 predictor::http://railstutorial.ru/stylesheets/polytexnic.css?1438286578 1,1,1459603220,0 predictor::http://railstutorial.ru/stylesheets/pygments.css?1438286578 1,1,1459603220,0 predictor::http://railstutorial.ru/stylesheets/screen.css?1438286578 1,1,1459603220,0 predictor::http://railstutorial.ru/stylesheets/custom.css?1438286578 1,1,1459603220,0 predictor::http://railstutorial.ru/javascripts/jquery-1.6.2.min.js?1438286578 1,1,1459603220,0 predictor::http://railstutorial.ru/javascripts/show_origin.js?1438286578 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/create_demo_repo_4_0.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_user_model.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_micropost_model.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_blank_user_index_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_new_user_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_show_user_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_edit_user_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_update_user_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_user_index_two_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_destroy_user_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/mvc_detailed.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_new_micropost_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_micropost_index_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/micropost_length_error_rails_3.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/micropost_user_association.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_model_inheritance.png 1,1,1459603220,0 predictor::http://railstutorial.ru/images/figures/demo_controller_inheritance.png 1,1,1459603220,0 predictor::http://railstutorial.ru/javascripts/orphus.js 1,1,1459603220,0 predictor::http://mc.yandex.ru/metrika/watch.js 1,1,1459603220,0 predictor::http://media.reformal.ru/widgets/v3/reformal.js 1,1,1459603220,0 predictor::http://reformal.ru/human_check/36662|aHR0cDovL3JhaWxzdHV0b3JpYWwucnUvY2hhcHRlcnMvNF8wL2EtZGVtby1hcHAjdG9w|aHR0cDovL3JhaWxzdHV0b3JpYWwucnUvY2hhcHRlcnMvNF8wL2JlZ2lubmluZw==|8005 1,1,1459603220,0  h8